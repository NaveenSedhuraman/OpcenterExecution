{"version":3,"sources":["swac-container.min.js"],"names":["swacContainerModule","SWAC","_services","_serviceOptions","_serviceContainerInstance","_handlers","_onServiceCreated","_onServiceRemoved","_cache","_handler","Component","name","iframe","type","settings","lastUrl","_that","this","_rootnode","_name","_iframe","_settings","_lastUrl","src","_addDpcValues","addDpcValues","Config","Container","Behaviors","AddDpcValues","_containerOnReadyEvent","arguments","_interfaces","_visibility","_dirty","_onReady","Eventing","Publisher","_supportedMouseEventList","_registeredEventList","_privateDpc","_authentication","Authentication","_proxy","_eventPublishers","_status","_dpc","_id","Guid","generate","_beginRemove","reason","defer","Defer","clean","_internal","remove","reject","Reason","promise","Communication","beginCall","TimeOuts","Remove","then","value","_beginCall","method","args","Proxy","Functions","_removeFromRegisteredEventList","event","i","length","splice","_getRegisteredEvent","item","_getEventLevelAndCategory","eventName","eventLevel","level","category","nestedMouseEventList","split","Utils","indexOf","beginShow","visible","change","newstate","flavor","style","width","height","display","Internal","fulfill","beginRemove","getDomain","beginPosition","left","top","beginCleanUpRequest","CleanUp","getPosition","hasUI","swacVersion","onReady","onMouseEvents","subscribe","callback","filters","arrayFilters","_callback","inherited","registeredEvent","evtLevel","eventToEnable","retVal","checkVersion","isArray","push","bubble","slice","call","unsubscribe","cbIndex","hiddenEventToDisable","eventToDisable","insertFromBubble","enable","beginExpose","api","events","hasPublicDpc","interfaces","version","internalDefer","failed","proceed","flags","fn","hasOwnProperty","join","Function","Interfaces","services","Services","list","cntService","servicesOption","getInfo","getFullName","window","parent","self","Hub","instance","delegable","notify","DPC","Flags","Permissions","Write","Read","Node","key","content","res","dpcChanged","beginDpcGet","modified","beginDpcSet","data","access","close","fire","evtname","evtobject","inf","succCallback","publicNode","toLowerCase","undefined","open","componentVersion","add","status","dpc","set","addEventListener","setComponentInternalStatus","beginGet","beginHandshake","tlsHandler","timeout","tlsMessage","message","receiveMessage","beginRequestInterface","exposeInterface","beginRequestService","serviceName","newCmpName","o","callService","service","newsource","callMethod","setCurrentUrl","getCurrentUrl","lastIsDirtyValue","manageEvent","evt","regEvent","evtObj","document","createEvent","initMouseEvent","bubbles","cancelable","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","_eventAdapter","SWACComponent","dispatchEvent","getRegisteredEvent","removeComponentServiceAndBubble","removeServices","JSON","stringify","proxy","_language","navigator","language","_componentRemovalInProgress","_observer","_beginCloseCalls","_publicRegistry","_creationRegistry","_onRemoved","_removeComponent","localCmpName","parentNode","removeChild","apply","_onFailure","_fireOnFailure","phase","async","details","_identify","published","registry","component","contentWindow","_onCreated","_setComponentInternalStatusInBag","privateStatus","bag","oldValue","failCallback","closeFlag","cleanCount","reasonCode","closeOnCleanUpTimeOut","beginCloseDeferer","Enabled","clearTimeout","beginCloseTimer","guid","closingBroadcast","closingComponents","loopInterrupted","_get","filter","candidate","candidateName","entry","sameAttr","found","arr","dirty","Object","prototype","toString","attributes","_findAndRemoveComponentfromList","componentName","bagIt","closingComponentsNames","MutationObserver","mutation","removedNodes","tagName","SWACLoaded","observe","body","childList","subtree","components","disconnect","beginCreate","arg","callBackOnLoadIframe","onLoadErrorCallback","source","ok","all","check","onsuccess","onfailure","checkIframe","createElement","location","href","state","frameBorder","position","e","target","srcElement","setAttribute","attachEvent","appendChild","setTimeout","Create","beginClose","nameComponents","broadcast","removeAllComponents","tmpcomponent","succClb","Close","CloseOnCleanUpTimeOut","CloseTimeoutConfirm","get","getLanguage","setLanguage","tag","forEach","cmp","onCreated","onRemoved","onFailure","accept","authentication","TlsHandler","Handshake","comp","discard","identify","getComponentInternalStatus","Exception","fireOnFailure","iFrameList","querySelectorAll","currentIframe","relatedComponent","keys","owner","_cachedEventPublisher","_available","_owner","_requestedInterfacesList","_has","_beginRequestInterfaceCallback","response","interfaceName","_findInRequestedInterfacesList","has","evPub","options","propName","parkFilter","filterOK","register","local","optionsProp","ServiceConstructor","match","getLocal","onServiceCreated","onServiceRemoved","expose","proceedPromise","getOwnPropertyNames","realCmpName","answerDefer","proceedDefer","fullName","prealCmpName","servObj","property","park","serviceDest","estractParameters","handler","provider","substring","delegated","serviceInf","beginGetInternal","serviceinstances","cachedCmpService","cmpList","relCmpName","parse","otherCmp","isNephew","j","cs","componentFull","module","exports","SWACConstructor","require","SystemJS","map","define","base","amd","requirejs","s","contexts","_","config","paths","Error","constructor"],"mappings":";;CAGA,WACE,IAAIA,EAAsB,SAAUC,GA80ErB,IAMXC,EACHC,EACCC,EACDC,EAOAC,EAOAC,EAEAC,EAyHAC,EAsPC,OArsFJR,EAAKS,UAAY,SAAUC,EAAMC,EAAQC,EAAMC,EAAUC,GAMvD,IACDC,EAAQC,KAERC,EAAY,KAEZC,EAAQR,EASRS,EAAUR,EAWVS,EAAYP,EAEZQ,EAAyB,KAAZP,GAAF,MAAsBA,EAAgDA,EAAUH,EAAOW,IAEjGC,OAAuC,IAAdH,QAAiE,IAA3BA,EAAUI,aAAiCJ,EAAUI,aAAexB,EAAKyB,OAAOC,UAAUC,UAAUC,aAEpKC,EAAyBC,UAAU,GAEnCC,EAAc,KAYbC,EAAc,SAGdC,GAAS,EAOTC,EAAW,IAAIlC,EAAKmC,SAASC,UAAU,WAEvCC,EAA2B,6CAG3BC,EAAuB,GAGvBC,EAAc,GAGdC,EAAkB,IAAIxC,EAAKyC,eAAe/B,GAQ1CgC,EAAS,GAGTC,EAAmB,GAQnBC,EAAU,GAQVC,EAAO,GAGPC,EAAM9C,EAAK+C,KAAKC,WA4CfC,EAAe,SAAUC,GACvB,IAAIC,EAAQ,IAAInD,EAAKoD,MAClBC,EAAQ,WACNrD,EAAK0B,UAAU4B,UAAUC,OAAOrC,EAAOC,EAAS+B,GAEhDjB,IADAd,EAAU,MAMVY,EADAY,EADAE,EADAD,EADAF,EAAS,MAOd,OAAIT,GACFkB,EAAMK,OAAO,IAAIxD,EAAKyD,OAAO,QAaxBN,EAAMO,SAVJ1D,EAAK2D,cAAcL,UAAUM,UAAU1C,EAAOlB,EAAKyB,OAAOoC,SAASC,OAAQ,SAAU,CAACZ,IAASa,KAClG,SAAUC,GACRX,KAEF,SAAUH,GAER,MADAG,IACMH,KAqFhBe,EAAa,SAAUC,EAAQC,GAC7B,OAAOnE,EAAK2D,cAAcL,UAAUM,UAAU1C,EAAOlB,EAAKyB,OAAOoC,SAASO,MAAMC,UAAW,OAAQ,CAACH,EAAQC,KA4Y/GG,EAAiC,SAAUC,GACzC,IAAIC,EAEJ,IAAKA,EAAIlC,EAAqBmC,OAAS,EAAQ,GAALD,EAAQA,IAC5ClC,EAAqBkC,GAAG9D,OAAS6D,GACnCjC,EAAqBoC,OAAOF,EAAG,IAarCG,EAAsB,SAAUJ,GAC9B,IAAIK,EAEJ,IAAKA,KAAQtC,EACX,GAAIA,EAAqBsC,GAAMlE,OAAS6D,EACtC,OAAOjC,EAAqBsC,GAGhC,OAAO,MAWRC,EAA4B,SAAUC,GACpC,IAAIC,EAAa,CACfC,MAAO,GACPC,SAAU,IAEXC,EAAuB7C,EAAyB8C,MAAM,KAQvD,OANqE,EAAjEnF,EAAKsD,UAAU8B,MAAMC,QAAQH,EAAsBJ,KAErDC,EAAWC,MAAQ,UACnBD,EAAWE,SAAW,eAGjBF,GAkUV/D,KAAKsE,UAh5BS,SAAUC,GACrB,IAEGC,EAFCrC,EAAQ,IAAInD,EAAKoD,MAClBqC,EAAWF,EAAU,UAAY,SAGpC,GAAItD,EACFkB,EAAMK,OAAO,IAAIxD,EAAKyD,OAAO,aAE7B,GAAyB,OAArBrC,EAAUsE,OACZvC,EAAMK,OAAO,IAAIxD,EAAKyD,OAAO,YACxB,CAAA,GAAIgC,IAAazD,EAYtB,OATAwD,EAAS,SAAUxB,GACjBhC,EAAcyD,EAEdtE,EAAQwE,MAAMC,MAASL,EAAUnE,EAAUwE,MAAQ,MACnDzE,EAAQwE,MAAME,OAAUN,EAAUnE,EAAUyE,OAAS,MACrD1E,EAAQwE,MAAMG,QAAWP,EAAU,QAAU,QAIxCvF,EAAK2D,cAAcL,UAAUM,UAAU1C,EAAOlB,EAAKyB,OAAOoC,SAASkC,SAAU,OAAQ,CAACR,IAAUxB,KAAKyB,EAAQA,GAXpHrC,EAAM6C,UAcV,OAAO7C,EAAMO,SAw3BhB1C,KAAKiF,YAAchD,EACnBjC,KAAKkF,UAhZQ,WACX,OAAO1D,EAAgB0D,aAiZzBlF,KAAKmF,cA/zBa,SAAUC,EAAMC,EAAKT,EAAOC,GAC3C,IAAI1C,EAAQ,IAAInD,EAAKoD,MAErB,OAAInB,GACFkB,EAAMK,OAAO,IAAIxD,EAAKyD,OAAO,QACtBN,EAAMO,SAGU,OAArBtC,EAAUsE,QACZvC,EAAMK,OAAO,IAAIxD,EAAKyD,OAAO,QACtBN,EAAMO,UAIK,WAAhB1B,IACFb,EAAQwE,MAAMS,KAAOA,EACrBjF,EAAQwE,MAAMU,IAAMA,EACpBlF,EAAQwE,MAAMC,MAAQA,EACtBzE,EAAQwE,MAAME,OAASA,GAIlB7F,EAAK2D,cAAcL,UAAUM,UAAU1C,EAAOlB,EAAKyB,OAAOoC,SAASkC,SAAU,WAAY,CAACK,EAAMC,EAAKT,EAAOC,MA2yBtH7E,KAAKsF,oBA/0BmB,WACrB,OAAOtG,EAAK2D,cAAcL,UAAUM,UAAU1C,EAAOlB,EAAKyB,OAAOoC,SAAS0C,QAAS,UAAW,IAAI,IA+0BrGvF,KAAKwF,YA/xBW,WACb,OAAIvE,EACK,KAGA,CACLmE,KAAMjF,EAAQwE,MAAMS,KACpBC,IAAKlF,EAAQwE,MAAMU,IACnBT,MAAOzE,EAAQwE,MAAMC,MACrBC,OAAQ1E,EAAQwE,MAAME,SAuxB7B7E,KAAKJ,KA3+BE,WAAc,OAAOA,GAm/B5BI,KAAKN,KAAO,WAAc,OAAOQ,GAQjCF,KAAKyF,MAAQ,WAAc,MAA4B,OAArBrF,EAAUsE,QAQ5C1E,KAAK0F,YAAc,QAGnB1F,KAAK2F,QAAUzE,EAASqC,MAExBvD,KAAK4F,cAAgB,CACnBC,UAnRgB,SAAUC,EAAUC,GACpC,IAAIC,EAAcxC,EAEhByC,EADAC,EAAkC,IAArBpF,UAAU2C,QAAgB3C,UAAU,GAEjDqF,EAAkB,KAClBC,EAAW,KACXC,EAAgB,GAChBC,GAAS,EAGX,GAAKtH,EAAKsD,UAAU8B,MAAMmC,aAAaxG,EAAM2F,YAAa,UAAY,EACpE,OAAO,EAGT,GAAyB,mBAAbI,IAA6BI,EACvC,OAAO,EAyBT,IArBED,EADsB,mBAAbH,EACG,GAGA,CAACA,GAIE,KAAZC,GAAD,MAAqBA,EACvBC,EAAe3E,EAAyB8C,MAAM,KAG1CnF,EAAKsD,UAAU8B,MAAMoC,QAAQT,GAC/BC,EAAeD,EAGU,iBAAbA,IACVC,EAAe,CAACD,IAKjBvC,EAAI,EAAGA,EAAIwC,EAAavC,OAAQD,IAEnC2C,EAAkBxC,EAAoBqC,EAAaxC,IAGnD4C,EAAWvC,EAA0BmC,EAAaxC,IAE1B,OAApB2C,EAEqB,KAAnBC,EAASpC,QAEX1C,EAAqBmF,KAAK,CAAE/G,KAAMsG,EAAaxC,GAAIkD,QAAQ,EAAOR,UAAWA,EAAWJ,SAAUG,EAAUU,MAAM,KAC3F,YAAnBP,EAASpC,OAEXqC,EAAcI,KAAKT,EAAaxC,IAE7B8C,IAEHA,GAAS,MAM6D,IAAtEtH,EAAKsD,UAAU8B,MAAMC,QAAQ8B,EAAgBL,SAAUA,IACzDK,EAAgBL,SAASW,KAAKX,GAG3BQ,IAEHA,GAAS,GAIXH,EAAkB,MAStB,OAJ2B,EAAvBE,EAAc5C,QAChBzE,EAAK2D,cAAcL,UAAUsE,KAAK1G,EAAO,uBAAwB,CAACmG,EAAeD,EAASpC,QAGrFsC,GAiMPO,YAxLkB,SAAUf,GAC5B,IAAqBtC,EACnBI,EAAMkD,EAENX,EAHEC,EAAW,KAEbW,EAA6C,IAArBjG,UAAU2C,OAAgB3C,UAAU,GAAK,GAEjEkG,EAAiB,GAEnB,GAAyB,mBAAblB,GAA6D,IAAhCiB,EAAqBtD,OAA9D,CAIA,GAAwB,mBAAbqC,EAET,IAAKlC,KAAQtC,EAEsC,EAA7CA,EAAqBsC,GAAMkC,SAASrC,SAIrB,KAFjBqD,EAAU9H,EAAKsD,UAAU8B,MAAMC,QAAQ/C,EAAqBsC,GAAMkC,SAAUA,MAI1ExE,EAAqBsC,GAAMkC,SAASpC,OAAOoD,EAAS,GACD,IAA/CxF,EAAqBsC,GAAMkC,SAASrC,QAAiBnC,EAAqBsC,GAAMqD,kBAE7E3F,EAAqBsC,GAAMsC,YAE9BE,EAAWvC,EAA0BvC,EAAqBsC,GAAMlE,MAEhEsH,EAAeP,KAAKnF,EAAqBsC,GAAMlE,aAYzD,IAHA0G,EAAW,CACTpC,MAAO,WAEJR,EAAI,EAAGA,EAAIuD,EAAqBtD,OAAQD,IAIlB,QAFzB2C,EAAkBxC,EAAoBoD,EAAqBvD,MAExB2C,EAAgBc,kBACjDD,EAAeP,KAAKN,EAAgBzG,MAK1C,GAA4B,EAAxBsH,EAAevD,OAAY,CAC7B,IAAKD,EAAI,EAAGA,EAAIwD,EAAevD,OAAQD,IAErCF,EAA+B0D,EAAexD,IAGhDxE,EAAK2D,cAAcL,UAAUsE,KAAK1G,EAAO,wBAAyB,CAAC8G,EAAgBZ,EAASpC,WAiI9F0C,OAtHa,SAAUQ,EAAQnB,GAC/B,IAAIC,EAAcxC,EAChB2C,EAAkB,KAClBC,EAAW,KACXC,EAAgB,GAChBW,EAAiB,GAEnB,GAAwB,kBAAZE,EAAuB,CAgBjC,IAdiB,KAAZnB,GAAD,MAAqBA,EACvBC,EAAe3E,EAAyB8C,MAAM,KAG1CnF,EAAKsD,UAAU8B,MAAMoC,QAAQT,GAC/BC,EAAeD,EAGU,iBAAbA,IACVC,EAAe,CAACD,IAKjBvC,EAAI,EAAGA,EAAIwC,EAAavC,OAAQD,IAEnC2C,EAAkBxC,EAAoBqC,EAAaxC,IAGnD4C,EAAWvC,EAA0BmC,EAAaxC,IAE1B,OAApB2C,EAEqB,KAAnBC,EAASpC,OACPkD,IAEF5F,EAAqBmF,KAAK,CAAE/G,KAAMsG,EAAaxC,GAAIkD,OAAQQ,EAAQhB,WAAW,EAAOJ,SAAU,GAAImB,kBAAkB,IAC9F,YAAnBb,EAASpC,OAEXqC,EAAcI,KAAKT,EAAaxC,MAOlC2C,EAAgBc,kBAAyD,IAApCd,EAAgBL,SAASrC,QAChEH,EAA+B0C,EAAaxC,IAC5CwD,EAAeP,KAAKT,EAAaxC,MAIjC2C,EAAgBO,OAASQ,EACzBf,EAAgBc,kBAAmB,GAGrCd,EAAkB,MAKK,EAAvBE,EAAc5C,QAChBzE,EAAK2D,cAAcL,UAAUsE,KAAK1G,EAAO,uBAAwB,CAACmG,EAAeD,EAASpC,QAIhE,EAAxBgD,EAAevD,QACjBzE,EAAK2D,cAAcL,UAAUsE,KAAK1G,EAAO,wBAAyB,CAAC8G,EAAgBZ,EAASpC,WAwDlGhE,KAAKsC,UAAY,CACf6E,YAjrBc,SAAUC,EAAKC,EAAQC,EAAcC,EAAYC,GAC9D,IACGC,EACJC,EACAC,EACAC,EAEAC,EAEAtE,EACAL,EATKf,EAAQ,IAAInD,EAAKoD,MAOtBoB,EAAI,EASH,IAAKN,KALDsE,IACFzH,EAAM2F,YAAc8B,GAIPJ,EACTA,EAAIU,eAAe5E,KAErB2E,EAAK,oBADET,EAAIlE,GAAQ6E,KAAK,MACU,2EAA6E7E,EAAS,gDAExHxB,EAAOwB,GAAU,IAAK8E,SAAS,MAAO,KAAMH,EAA3B,CAAgC9H,EAAOkD,IAM5D,IAAKO,EAAI,EAAGA,EAAI6D,EAAO5D,OAAQD,IAC7BD,EAAQ8D,EAAO7D,GACf7B,EAAiB4B,GAAS,IAAIvE,EAAKmC,SAASC,UAAUmC,GACtD7B,EAAO6B,GAAS5B,EAAiB4B,GAAOA,MAkE1C,OA9DAxD,EAAMwH,WAAaxG,EAAc,IAAI/B,EAAKiJ,WAAWV,EAAYxH,GAGjE2H,EAAS,SAAUxF,GACjBC,EAAMK,OAAON,IAGfyF,EAAU,SAAU3E,GAClB,IAAIkF,EAAWlJ,EAAKmJ,SAASC,OAC5B5E,EAAI,EACJ6E,EAAa,GACTC,EAAiB,GACtB,IAAK9E,EAAI,EAAGA,EAAI0E,EAASzE,OAAQD,IAC/B8E,EAAeJ,EAAS1E,IAAMxE,EAAKmJ,SAASI,QAAQL,EAAS1E,IACxD8E,EAAeJ,EAAS1E,IAAc,WACrCxE,EAAKsD,UAAU8B,MAAMoE,cACvBF,EAAeJ,EAAS1E,IAAc,SAAIxE,EAAKsD,UAAU8B,MAAMoE,cAEnB,mBAA9BC,OAAwB,iBAAoBA,OAAOC,SAAWC,KAC5EL,EAAeJ,EAAS1E,IAAc,SAAI,CAAC,UAG3C8E,EAAeJ,EAAS1E,IAAe,WAAI,GAIjD,GAAqE,GAAjExE,EAAKsD,UAAU8B,MAAMmC,aAAaxG,EAAM2F,YAAa,UACtB,iBAAtB1G,EAAK4J,IAAIC,SAElB,IADAR,EAAarJ,EAAK4J,IAAIC,SAASX,SAASE,KAAK,CAAEU,WAAW,IACrDtF,EAAI,EAAGA,EAAI6E,EAAW5E,OAASD,KAC6B,IAA3DxE,EAAKsD,UAAU8B,MAAMC,QAAQ6D,EAAUG,EAAW7E,MACpD8E,EAAeD,EAAW7E,IAAMxE,EAAK4J,IAAIC,SAASX,SAASK,QAAQF,EAAW7E,KAOtFiE,EAAgB,IAAIzI,EAAKoD,MACzBD,EAAM6C,QAAQyC,EAAc/E,SAE5B1D,EAAK2D,cAAcL,UAAUM,UAAU1C,EAAOlB,EAAKyB,OAAOoC,SAASkC,SAAU,QAAS,CAACmD,EAAUI,IAAiBvF,KAC/G,WACE0E,EAAczC,UACdnE,EAAuBkI,OAAO,CAAErJ,KAAMQ,IAAS,GAC/CgB,EAAS6H,OAAO,CAAErJ,KAAMQ,IAAS,IAE3B,SAAUgC,GACRuF,EAAcjF,OAAON,MAIpC0F,EAAQ5I,EAAKgK,IAAI1G,UAAU2G,MAAM7F,MAAQpE,EAAKgK,IAAIE,YAAYC,MAAQnK,EAAKgK,IAAIE,YAAYE,KAE3FnJ,EAAY,IAAIjB,EAAKgK,IAAIK,KAxIlB,SAAUC,EAAK1J,EAAM2J,GAC1B,IAAIC,EAAM,KAGV,GAAa,QAAT5J,GAA2B,QAATA,GAA2B,WAATA,EAEtCZ,EAAK2D,cAAcL,UAAUmH,WAAWvJ,EAAOoJ,EAAK1J,EAAM2J,OAEvD,CAAA,GAAa,QAAT3J,EAEP,OAAOZ,EAAK2D,cAAcL,UAAUoH,YAAYxJ,EAAOoJ,GAEpD,GAAa,aAAT1J,EACP,OAAKZ,EAAKsD,UAAU8B,MAAMmC,aAAaxG,EAAM2F,YAAa,UAAY,GACpE8D,EAAM,IAAIxK,EAAKoD,MACfpD,EAAK2D,cAAcL,UAAUmH,WAAWvJ,EAAOoJ,EAAK,MAAOC,GAC3DC,EAAIxE,QAAQ,CAAE2E,UAAU,IACjBH,EAAI9G,SAIJ1D,EAAK2D,cAAcL,UAAUsH,YAAY1J,EAAOoJ,EAAK1J,EAAM2J,GAASxG,KAC1E,SAAU8G,GACR,MAAoB,iBAATA,GAA8C,kBAAlBA,EAAKF,SACnCE,EAEF,CAAEF,UAAU,IAClB,SAAUzH,GACX,MAAMA,MA4GmCJ,EAAK8F,GAEvDrG,EAActB,EAAU6J,OAAOhI,GAE/B9C,EAAK2D,cAAcL,UAAUM,UAAU1C,EAAOlB,EAAKyB,OAAOoC,SAASkC,SAAU,OAAQ,IAAIhC,KACtF4E,EAASD,GAGLvF,EAAMO,SAilBdqH,MAnfQ,SAAU7H,GACjBD,EAAaC,IAmfd8H,KAtkBO,SAAUC,EAASC,EAAWC,GACjB,iBAARA,EACTpJ,EAAYuB,UAAU0H,KAAKC,EAASC,EAAWC,GAE/CxI,EAAiBsI,GAASlB,OAAOmB,IAmkBpCT,WAtjBa,SAAUH,EAAK1J,EAAM2J,GAEjC,IAAIa,EAAcC,EAAa,KAElB,WAATzK,EACF2B,EAAYgB,OAAO+G,GACD,QAAT1J,IAEwC,IAA3C0J,EAAIgB,cAAcjG,QAAQ,cAC5BkF,EAAQ3B,MAAQ2B,EAAQ3B,MAAQ5I,EAAKgK,IAAIE,YAAYC,OAE3C,WAARG,OAC+BiB,IAA7BtK,EAAUuK,KAAK,aACjBH,EAAa,IAAIrL,EAAKgK,IAAIK,KAAKpJ,EAAW6B,EAAK9C,EAAKgK,IAAIE,YAAYE,KAAOpK,EAAKgK,IAAIE,YAAYC,MAAQnK,EAAKgK,IAAI1G,UAAU2G,MAAM7F,MAAO,WAC7HqH,iBAAmB1K,EAAM2F,YACpC2E,EAAW7J,aAAeD,GAI5BgB,EAAYmJ,IAAIpB,EAAKC,EAAQ3B,OAEnB,YAAR0B,IACF1H,EAAU3B,EAAUuK,KAAK,WAAWV,SACpC/J,EAAM4K,OAAS/I,GAEL,WAAR0H,IACFzH,EAAO5B,EAAUuK,KAAK,UAAUV,SAChC/J,EAAM6K,IAAM/I,IAGE,QAATjC,KAEwC,IAA3C0J,EAAIgB,cAAcjG,QAAQ,aACxBkF,EAAQ3B,MAAQ5I,EAAKgK,IAAIE,YAAYC,QACvCI,EAAQ3B,MAAQ2B,EAAQ3B,MAAQ5I,EAAKgK,IAAIE,YAAYC,OAGzD5H,EAAYsJ,IAAIvB,EAAK,EAAkBC,EAAQvG,MAAQ,KAAMuG,EAAQ3J,KAAM2J,EAAQ3B,OAC9Ea,OAAOqC,kBACG,oBAARxB,GAA0D,kBAAnBC,EAAa,OACvDvK,EAAK0B,UAAU4B,UAAUyI,2BAA2B7K,EAAOqJ,EAAQvG,QAM5D,QAATpD,IAAgE,IAA3C0J,EAAIgB,cAAcjG,QAAQ,cACnD+F,EAAe,WACb,OAAO,SAAUpH,GACQ,kBAAZ,GACThE,EAAK0B,UAAU4B,UAAUyI,2BAA2B7K,EAAO8C,KAIjE/C,EAAU6J,SAASU,KAAKlB,GAAK0B,WAAWjI,KAAKqH,OAigBhDa,eA1ee,SAAUC,EAAYC,GACtC,OAAO3J,EAAgBc,UAAU2I,eAAeC,EAAY,KAAMC,IA0ejEC,WAheW,SAAUC,GACtB7J,EAAgBc,UAAUgJ,eAAeD,IAgexCE,sBAxyBwB,SAAU7L,GACjC,IAAIyC,EAAQ,IAAInD,EAAKoD,MAsBrB,OApBApD,EAAK2D,cAAcL,UAAUM,UAAU1C,EAAOlB,EAAKyB,OAAOoC,SAASkC,SAAU,wBAAyB,CAACrF,IAAOqD,KAC3G,SAAUoH,GACJA,GACFpJ,EAAYuB,UAAUkJ,gBAAgBrB,EAAIzK,KAAMyK,EAAI/C,IAAK+C,EAAI9C,QAC7DtG,EAAYiK,SAAStL,GAAMqD,KACzB,SAAUC,GACRb,EAAM6C,QAAQhC,IAEhB,SAAUd,GACRC,EAAMK,OAAON,MAIjBC,EAAMK,OAAO,IAAIxD,EAAKyD,OAAO,SAGjC,SAAUP,GACRC,EAAMK,OAAON,KAGXC,EAAMO,SAkxBd+I,oBAvwBsB,SAAUC,GAE/B,IAAIC,EAAa3L,KAAK4L,EACtB,OAAO5M,EAAKmJ,SAAS7F,UAAUmJ,oBAAoBC,EAAaC,IAqwBjEE,YAxvBc,SAAU3I,EAAQC,EAAM2I,GACrC,IAAIC,EAAY,GAIhB,OAHI/L,KAAK4L,IACPG,EAAY/L,KAAK4L,GAEZ5M,EAAKmJ,SAAS7F,UAAU0J,WAAWD,EAAWD,EAAS5I,EAAQC,IAovBvE8I,cA9ce,SAAUnM,GACzBO,EAAWP,GA8cXoM,cA1de,WACf,OAAO7L,GA0dPV,OAAQQ,EACRgM,kBAvgCiB,EAwgCjBC,YArVa,SAAUjJ,GACvB,IAAgBK,EAAZ6I,EAAM,KACRC,EAAW,KAKb,GAAiB,QAFjBA,EAAW3I,EAAoBR,EAAKvD,OAEb,CAarB,IAXAyM,EArCY,SAAUlJ,GACxB,IAAIoJ,EAAS,KACXF,EAAM,KAKR,GAAkB,MAFlBA,EAAMxI,EAA0BV,EAAKvD,OAE7BoE,MACN,OAAQqI,EAAIpI,UACV,IAAK,eACHsI,EAASC,SAASC,YAAY,gBACvBC,eAAevJ,EAAKvD,KAAMuD,EAAKwJ,QAASxJ,EAAKyJ,WAAY,KAAMzJ,EAAK0J,OAAQ1J,EAAK2J,QAAS3J,EAAK4J,QACtG5J,EAAK6J,QAAS7J,EAAK8J,QAAS9J,EAAK+J,QAAS/J,EAAKgK,OAAQhK,EAAKiK,SAAUjK,EAAKkK,QAASlK,EAAKmK,OAAQnN,GAMvG,OAFAkM,EAAM,KAECE,EAmBCgB,CAAcpK,IAGhBqK,cAAgBzN,GAEI,IAApBuM,EAAS5F,QAEXvG,EAAQsN,cAAcpB,GAIO,EAA3BC,EAASxG,SAASrC,OACpB,IAAKD,EAAI,EAAGA,EAAI8I,EAASxG,SAASrC,OAAQD,IACpC8I,EAASxG,SAAStC,IACpB8I,EAASxG,SAAStC,GAAG6I,GAMvBC,EAASpG,YAAcoG,EAASrF,kBAClCjI,EAAK2D,cAAcL,UAAUsE,KAAK,KAAM,cAAe,CAACzD,IAI1DkJ,EADAC,EAAW,OAqTboB,mBAAoB/J,EACpBgK,gCA/bgC,WACjC,IAAIxK,EAAOnD,KAAK4L,EAChB5M,EAAKmJ,SAAS7F,UAAUsL,eAAeC,KAAKC,UAAU3K,IAClDnE,EAAKsD,UAAU8B,MAAMoE,eACvBxJ,EAAK2D,cAAcL,UAAUsE,KAAK,KAAM,kCAAmC,KAAMzD,KA+bpFnD,KAAK+N,MAAQrM,EAQb1B,KAAKuH,WAAa,MAepBvI,EAAK0B,UAAa,WAMhB,IACIsN,EAAYvF,OAAOwF,UAAUC,SAC7BC,GAA8B,EAE9BC,EAAY,KACZC,EAAmB,GAGnBC,EAAkB,GAGlBC,EAAoB,GAEpB3M,EAAU,IAAK5C,EAAKgK,IAAIK,KAAK,KAAM,QAASrK,EAAKgK,IAAIE,YAAYE,KAAM,UAAU,GAEjFoF,EAAa,IAAIxP,EAAKmC,SAASC,UAAU,aAEzCQ,EAAQiJ,IAAI,QAAS,WAAW,EAAO,WAWxC,IAAI4D,EAAmB,SAAU/O,EAAMC,EAAQuC,GAC7C,IAAIwM,EAAe1P,EAAKsD,UAAU8B,MAAMoE,cAEpC8F,EAAgB5O,KACdC,IACFA,EAAOW,IAAM,cACTX,EAAOgP,aACTR,GAA8B,EAC9BxO,EAAOgP,WAAWC,YAAYjP,IAEhCA,EAAS,MAEXuC,EAASA,GAAkB,GACvBwM,GACFA,EAAajI,KAAK/G,GAClB4O,EAAgB5O,GAAM4C,UAAUqL,gCAAgCkB,MAAM,CAAEjD,EAAG8C,KAG3E1P,EAAKmJ,SAAS7F,UAAUsL,eAAe,cAAgBlO,EAAO,aAEzD4O,EAAgB5O,GACvB8O,EAAWzF,OAAO,CAAErJ,KAAMA,EAAMwC,OAAQA,MA0G7C4M,EAAa,IAAI9P,EAAKmC,SAASC,UAAU,aAY3C2N,EAAiB,SAAUrP,EAAMsP,EAAO9M,EAAQ+M,GAC9CH,EAAW/F,OAAO,CAAErJ,KAAMA,EAAMwP,QAAS,CAAEF,MAAOA,EAAO9M,OAAQA,IAAY+M,IA6K/EE,EAAY,SAAUxP,EAAQyP,GAC5B,IAAIC,EAAWD,EAAYd,EAAkBC,EAC3CjF,EAAM,KACNgG,EAAY,KAEd,IAAKhG,KAAO+F,EACV,GAAIA,EAASvH,eAAewB,GAE1B,GADAgG,EAAYD,EAAS/F,GACjB+F,IAAad,GACf,GAAKe,EAAU3P,OAAO4P,gBAAkB5P,GAAY2P,EAAU3P,SAAWA,EACvE,OAAO2P,OAIT,GAAKA,EAAUhN,UAAU3C,OAAO4P,gBAAkB5P,GAAY2P,EAAUhN,UAAU3C,SAAWA,EAC3F,OAAO2P,EAOf,IAAKF,EACH,OAAOD,EAAUxP,GAAQ,IAI3B6P,EAAa,IAAIxQ,EAAKmC,SAASC,UAAU,aACzCF,EAAW,IAAIlC,EAAKmC,SAASC,UAAU,WAwDvCqO,EAAmC,SAAU/P,EAAMgQ,EAAeC,EAAKL,EAAWM,GAChF,IAAIC,EACJC,GAAY,EACZC,EAAa,EACbvM,EAAI,EAmBJ,GAhBAqM,EAAe,WACb,OAAO,SAAU3N,GACW,QAAtBA,EAAO8N,YAAyBL,EAAIM,wBACtCN,EAAIO,kBAAkB1N,OAAON,GACzBlD,EAAKyB,OAAOoC,SAASsN,SACvB1H,OAAO2H,aAAaT,EAAIU,wBAEnBhC,EAAiBsB,EAAIW,UAKY,IAAzChB,EAAUhN,UAAU6J,mBAA4C,IAAbyD,IAAiD,IAAzBD,EAAIY,kBAClFjB,EAAUhK,sBAAsBvC,KAAK,KAAM8M,MAGA,IAAzCP,EAAUhN,UAAU6J,iBAA4B,CAClD,IAAK3I,EAAI,EAAGA,EAAImM,EAAIa,kBAAkB/M,OAAQD,IACD,OAAvCmM,EAAIa,kBAAkBhN,GAAG8L,YACjBK,EAAIa,kBAAkBhN,GAAG8L,UAAUhN,UAAU6J,iBAEjDwD,EAAIY,mBACNT,GAAY,GAIdC,IAEEA,IAAeJ,EAAIa,kBAAkB/M,SACvCkM,EAAIc,iBAAkB,IAK5B,GAAKd,EAAIY,kBAAoBT,IAAgBH,EAAIY,mBAAqBZ,EAAIc,gBAAkB,CAC1F,IAAKjN,EAAI,EAAGA,EAAImM,EAAIa,kBAAkB/M,OAAQD,IACD,OAAvCmM,EAAIa,kBAAkBhN,GAAG8L,WAC3BK,EAAIa,kBAAkBhN,GAAG8L,UAAUrK,cAGnCjG,EAAKyB,OAAOoC,SAASsN,SACvB1H,OAAO2H,aAAaT,EAAIU,oBAalCK,EAAO,SAAUC,GACf,IAEEC,EACAC,EAEAC,EACAC,EANEC,EAAQ,GACVxN,EAAI,EAGJyN,EAAM,GAIR,GAAIN,EAAQ,CACV,GAAIA,EAAOjR,KACT,GAA6B,iBAAjBiR,EAAW,KAAgB,CACrC,IAAKA,EAAO/Q,OAAS+Q,EAAOO,MAC1B,OAAO5C,EAAgBqC,EAAOjR,MAG9BsR,EAAMvK,KAAK6H,EAAgBqC,EAAOjR,YAGjC,GAAoD,mBAAhDyR,OAAOC,UAAUC,SAASzK,KAAK+J,EAAOjR,MAC7C,IAAKmR,KAAiBF,EAAOjR,KAC3B,GAAIiR,EAAOjR,KAAKoI,eAAe+I,GAC7B,IAAKD,KAAatC,EACZA,EAAgBxG,eAAe8I,IAActC,EAAgBsC,GAAWlR,SAAWiR,EAAOjR,KAAKmR,IACjGG,EAAMvK,KAAK6H,EAAgBsC,IAOvC,GAAID,EAAO/Q,KACT,GAAK+Q,EAAOjR,KAQV,IAAK8D,EAAIwN,EAAMvN,OAAS,EAAQ,GAALD,EAAQA,IAC7BwN,EAAMxN,IAAMwN,EAAMxN,GAAG5D,SAAW+Q,EAAO/Q,MACzCoR,EAAMtN,OAAOF,EAAG,QATpB,IAAKoN,KAAatC,EACZA,EAAgBxG,eAAe8I,IAActC,EAAgBsC,GAAWhR,SAAW+Q,EAAO/Q,MAC5FoR,EAAMvK,KAAK6H,EAAgBsC,IAYnC,GAAID,EAAOO,MACT,GAAMP,EAAOjR,MAAWiR,EAAO/Q,KAQ7B,IAAK4D,EAAIwN,EAAMvN,OAAS,EAAQ,GAALD,EAAQA,IAC7BwN,EAAMxN,IAAOwN,EAAMxN,GAAGlB,UAAU6J,mBAAqBwE,EAAOO,OAC9DF,EAAMtN,OAAOF,EAAG,QATpB,IAAKoN,KAAatC,EACZA,EAAgBxG,eAAe8I,IAAetC,EAAgBsC,GAAWtO,UAAU6J,mBAAqBwE,EAAOO,OACjHF,EAAMvK,KAAK6H,EAAgBsC,IAYnC,GAAID,EAAOW,WACT,IAAKV,KAAatC,EAChB,GAAIA,EAAgBxG,eAAe8I,IAActC,EAAgBsC,GAAWU,WAAY,CAEtF,IAAKR,KADLC,GAAW,EACGJ,EAAOW,WACnB,GAAIX,EAAOW,WAAWxJ,eAAegJ,MAC9BxC,EAAgBsC,GAAWU,WAAWxJ,eAAegJ,IAAUxC,EAAgBsC,GAAWU,WAAWR,KAAWH,EAAOW,WAAWR,IAAQ,CAC7IC,GAAW,EACX,MAIFA,GACFC,EAAMvK,KAAK6H,EAAgBsC,IAKnC,OAAOI,EAGP,IAAKF,KAASxC,EACRA,EAAgBxG,eAAegJ,IACjCG,EAAIxK,KAAK6H,EAAgBwC,IAG7B,OAAOG,GA8GTM,EAAkC,SAAUC,EAAe7B,GACzD,IAAInM,EACJ,IAAKA,EAAI,EAAGA,EAAImM,EAAIa,kBAAkB/M,OAAQD,IAC5C,GAAImM,EAAIa,kBAAkBhN,GAAG9D,OAAS8R,EAEpC,OADA7B,EAAIa,kBAAkB9M,OAAOF,EAAG,IACzB,EAGX,OAAO,GAoQX,OAnCAgL,EAAWjL,MAAMsC,UAvNC,SAAUtC,GAC1B,IAAIkO,EAAO9B,EACX,IAAK8B,KAASpD,EACRA,EAAiBvG,eAAe2J,KAClC9B,EAAMtB,EAAiBoD,IAC6D,EAAhFzS,EAAKsD,UAAU8B,MAAMC,QAAQsL,EAAI+B,uBAAwBnO,EAAMsG,KAAKnK,KAAM,IACxE6R,EAAgChO,EAAMsG,KAAKnK,KAAMiQ,IACd,IAAjCA,EAAIa,kBAAkB/M,SACxBkM,EAAIO,kBAAkBlL,iBACfqJ,EAAiBsB,EAAIW,UAgNxCd,EAAWjM,MAAMsC,UAAU,WACrB4C,OAAyB,kBAAmB,OAAd2F,IAChCA,EAAY,IAAIuD,iBAAiB,SAAUC,GACF,EAAlCA,EAAS,GAAGC,aAAapO,QAAwD,WAAxCmO,EAAS,GAAGC,aAAa,GAAGC,SAClB,kBAA3CF,EAAS,GAAGC,aAAa,GAAGE,aACjC5D,EACFA,GAA8B,GAG9BY,EAAe6C,EAAS,GAAGC,aAAa,GAAGnS,KAAM,iBAAkB,sCAAsC,GACzG+O,EAAiBmD,EAAS,GAAGC,aAAa,GAAGnS,KAAM,KAAM,IAAIV,EAAKyD,OAAO,aAKvEuP,QAAQxF,SAASyF,KAAM,CAAEC,WAAW,EAAMC,SAAS,MAIjE3D,EAAWjL,MAAMsC,UAAU,WACzB,IAAIuM,EAAa1B,IACb0B,GAAoC,IAAtBA,EAAW3O,QACvBgF,OAAyB,kBAAmB,OAAd2F,IAChCA,EAAUiE,aACVjE,EAAY,QASX,CAGLkE,YA7uBa,SAAUnP,GAKvB,IAvJiCoP,EAM/BC,EACAC,EACA9S,EAPEwC,EACFuG,EACAgK,EACA7S,EACAH,EAuKMS,EArBJgC,EAAQ,IAAInD,EAAKoD,MACnBuQ,EAAK,EACLjL,EAAS,EACTkL,EAAM,EACNC,EAAQ,WACFF,IAAOC,EACTzQ,EAAM6C,UACI2N,EAAKjL,IAAYkL,GAC3BzQ,EAAMK,OAAO,IAAIxD,EAAKyD,OAAO,SAGjCqQ,EAAY,WACVH,IACAE,KAEFE,EAAY,WACVrL,IACAmL,KAEFrP,EAAI,EAaN,GAAIxE,EAAKsD,UAAU8B,MAAMoC,QAAQrD,GAAO,CAGtC,IAFAyP,EAAMzP,EAAKM,OAEND,EAAI,EAAGA,EAAIoP,EAAKpP,IACnBxE,EAAK0B,UAAU4R,YAAYnP,EAAKK,IAAIT,KAAK+P,EAAWC,GAGtD,OAAO5Q,EAAMO,QAIf,GAAc,OAATS,GAAmC,iBAATA,EA2E/B,OADAhB,EAAMK,OAAO,IAAIxD,EAAKyD,OAAO,QACtBN,EAAMO,QAzEX,GAAI6L,EAAkBpL,EAAKzD,OAAS4O,EAAgBnL,EAAKzD,MAAO,CAC9D,GAAKV,EAAK0B,UAAU4B,UAAU0Q,YAAY7P,EAAKzD,MAO7C,OAFAqP,EAAe5L,EAAKzD,KAAM,WAAY,yCAAyC,GAC/EyC,EAAMK,OAAO,IAAIxD,EAAKyD,OAAO,QACtBN,EAAMO,QANbqM,EAAe5L,EAAKzD,KAAM,iBAAkB,sCAAsC,GAClF+O,EAAiBtL,EAAKzD,KAAM,KAAM,IAAIV,EAAKyD,OAAO,QAStD,OAAKU,EAAKuP,QAAWvP,EAAKzD,OApCpBS,EAAUqM,SAASyG,cAAc,WAC7B3S,IAAM6C,EAAKuP,QACfvS,EAAQG,MAAQmI,OAAOyK,SAASC,KAClChT,EAAU,OAGZA,EAAU,QAwCPgD,EAAKtD,WACRsD,EAAKtD,SAAW,IAGbsD,EAAKtD,SAAS6E,SACjBvB,EAAKtD,SAAS6E,OAAS,MAGzB6J,EAAkBpL,EAAKzD,MAAQ,CAC7BA,KAAMyD,EAAKzD,KACXE,KAAMuD,EAAKvD,KACXwT,MAAO,UACPvT,SAAUsD,EAAKtD,SACf6C,QAASP,EACTrC,QAAS,KAxOoByS,EA2OZpP,EA1OjBhB,EAAQ,IAAInD,EAAKoD,MACnBsG,EAAS6J,EAAI7J,OAAS6J,EAAI7J,OAAS8D,SAASyF,KAC5CS,EAASH,EAAIG,OACb7S,EAAW0S,EAAI1S,SACfH,EAAO6S,EAAI7S,MAObC,EAAS6M,SAASyG,cAAc,WACzB3S,IAAMoS,EACb/S,EAAO0T,YAAc,EACrB1T,EAAOD,KAAOA,EAEdC,EAAOgF,MAAM2O,SAAW,WACxB3T,EAAOoS,YAAa,GAEK,OAApBlS,EAAS6E,QAAsB7E,EAASuF,MAASvF,EAASwF,OAKvDoD,OAAOqC,kBAAuBjL,EAASuF,MAASvF,EAASwF,MAK7D1F,EAAOgF,MAAMS,KAAOvF,EAASuF,KAC7BzF,EAAOgF,MAAMU,IAAMxF,EAASwF,MAV9BxF,EAASuF,KAAO,MAChBvF,EAASwF,IAAM,OAajB1F,EAAOgF,MAAMC,MAAQ,MACrBjF,EAAOgF,MAAME,OAAS,MACtBlF,EAAOgF,MAAMG,QAAU,OAIvB0N,EAAuB,SAAUe,GAC/B,IAAIC,EAASD,EAAEC,OAASD,EAAEC,OAASD,EAAEE,WAEhCD,GAIDjF,EAAkBiF,EAAO9T,OAAS4O,EAAgBkF,EAAO9T,UACjC,IAAtB8T,EAAOzB,YAETyB,EAAOzB,YAAa,EACpB5P,EAAM6C,QAAQwO,IAGVlF,EAAgBkF,EAAO9T,OACzB8T,EAAOE,aAAa,oBAAqB,SAX7CvR,EAAMK,OAAO,IAAIxD,EAAKyD,OAAO,UANjC8L,EAAkBgE,EAAI7S,MAAMC,OAASA,GAuB1BmL,iBACTnL,EAAOmL,iBAAiB,OAAQ0H,GAGhC7S,EAAOgU,YAAY,SAAUnB,GAG/BC,EAAsB,WACpB9S,EAAOW,IAAM,cACb,IACE6N,GAA8B,EAC9BzF,EAAOkG,YAAYjP,GACnBA,EAAS,KAEX,MAAO4T,IAEPpR,EAAMK,OAAO,IAAIxD,EAAKyD,OAAO,SAG3B9C,EAAOmL,iBACTnL,EAAOmL,iBAAiB,QAAS2H,GAGjC9S,EAAOgU,YAAY,UAAWlB,GAGhC/J,EAAOkL,YAAYjU,GACnBA,EAAS,KAEFwC,EAAMO,SAgJcK,KAErB,SAAUpD,GAiBJ4O,EAAkBpL,EAAKzD,OACrBV,EAAKyB,OAAOoC,SAASsN,UACvB5B,EAAkBpL,EAAKzD,MAAMyL,QAAU1C,OAAOoL,WAlB7B,WACftF,EAAkBpL,EAAKzD,OAAiD,YAAvC6O,EAAkBpL,EAAKzD,MAAM0T,QAEhEzT,EAAOW,IAAM,cACTX,EAAOgP,aACTR,GAA8B,EAC9BxO,EAAOgP,WAAWC,YAAYjP,IAEhCA,EAAS,KACToP,EAAe5L,EAAKzD,KAAM,WAAY,gCAAgC,GAEtE6O,EAAkBpL,EAAKzD,MAAMgD,QAAQF,OAAO,IAAIxD,EAAKyD,OAAO,eACrD8L,EAAkBpL,EAAKzD,QAM2CV,EAAKyB,OAAOoC,SAASiR,UAIpG,SAAU5R,GACRC,EAAMK,OAAON,MA/CjBC,EAAMK,OAAO,IAAIxD,EAAKyD,OAAO,SAL7BN,EAAMK,OAAO,IAAIxD,EAAKyD,OAAO,QAwDxBN,EAAMO,SAwnBfqR,WApOY,SAAUC,EAAgBC,EAAW9I,EAAS8E,GAC1D,IAGEiE,EAHE9B,EAAa,KACf+B,EAAe,KACfrE,GAAY,EAEZD,EAAe,KACduE,EAAU,KACX5Q,EAAI,EAEJ8M,EAAOtR,EAAK+C,KAAKC,WACjB2N,EAAM,CACJW,KAAMA,GAyBV,IAtBAjC,EAAiBiC,GAAQX,GACrBO,kBAAoB,IAAIlR,EAAKoD,MACjC+I,EAAUA,GAAWnM,EAAKyB,OAAOoC,SAASwR,MAC1CJ,EAAY,MAAEA,GAA2DA,EAGvEhE,EADEA,MAAAA,GAAmG,KAA1BA,EACnDA,EAEyC,OAA1DjR,EAAKyB,OAAOC,UAAUC,UAAU2T,4BAA4F/J,IAA1DvL,EAAKyB,OAAOC,UAAUC,UAAU2T,uBAAiG,KAA1DtV,EAAKyB,OAAOC,UAAUC,UAAU2T,sBACxJtV,EAAKyB,OAAOC,UAAUC,UAAU2T,sBAEO,OAAxDtV,EAAKyB,OAAOC,UAAUC,UAAU4T,0BAAwFhK,IAAxDvL,EAAKyB,OAAOC,UAAUC,UAAU4T,qBAA6F,KAAxDvV,EAAKyB,OAAOC,UAAUC,UAAU4T,qBACpJvV,EAAKyB,OAAOC,UAAUC,UAAU4T,oBAM1D5E,EAAIM,sBAAwBA,EAC5BN,EAAIY,iBAAmB0D,EACvBtE,EAAIc,iBAAkB,EAElB,MAACuD,EACH5B,EAAa1B,QAEV,CACH,GAAI1R,EAAKsD,UAAU8B,MAAMoC,QAAQwN,GAE/B,IADA5B,EAAa,GACR5O,EAAI,EAAGA,EAAIwQ,EAAevQ,OAAQD,KACrC2Q,EAAezD,EAAK,CAAEhR,KAAMsU,EAAexQ,OAEzC4O,EAAW3L,KAAK0N,QAKpB/B,EAAa1B,EAAK,CAAEhR,KAAMsU,OAExB5B,EAAa,CAACA,IAIlB,GAAIA,MAAAA,GAAyE,IAAtBA,EAAW3O,OAGhE,OAFAkM,EAAIO,kBAAkB1N,OAAO,IAAIxD,EAAKyD,OAAO,eACtC4L,EAAiBiC,GACjBX,EAAIO,kBAAkBxN,QAMjC,IAFAiN,EAAIa,kBAAoB,GACxBb,EAAI+B,uBAAyB,GACxBlO,EAAI,EAAGA,EAAI4O,EAAW3O,OAAQD,IACX,OAAlB4O,EAAW5O,KACbmM,EAAI+B,uBAAuBjL,KAAK2L,EAAW5O,GAAG9D,QAC9CiQ,EAAIa,kBAAkB/J,KAAK,CAAE6I,UAAW8C,EAAW5O,GAAI9D,KAAM0S,EAAW5O,GAAG9D,UAgE/E,IA5DAwU,EAAsB,WACpB,IAAK1Q,EAAI,EAAGA,EAAI4O,EAAW3O,OAAQD,IACX,OAAlB4O,EAAW5O,IACb4O,EAAW5O,GAAGyB,eAKhBjG,EAAKyB,OAAOoC,SAASsN,UACvBR,EAAIU,gBAAkB5H,OAAOoL,WAAW,WAClC5D,EACFiE,KAGAvE,EAAIO,kBAAkB1N,OAAO,IAAIxD,EAAKyD,OAAO,eACtC4L,EAAiBiC,KAEzBnF,IAEL0E,EAAe,SAAU3N,GACvB,GAA0B,QAAtBA,EAAO8N,YAAyBC,EAO/B,CACH,GAAIgE,EACF,OAGE7B,IADJ5O,GAEY4O,EAAW5O,GAAGlB,UAAU6J,kBAEhCiG,EAAW5O,GAAG8B,sBAAsBvC,KAAKqR,EAASvE,GAIpDF,EAAIc,iBAAkB,OAlBxBd,EAAIO,kBAAkB1N,OAAON,GACzBlD,EAAKyB,OAAOoC,SAASsN,SACvB1H,OAAO2H,aAAaT,EAAIU,wBAEnBhC,EAAiBiC,IAmB5B8D,EAAU,SAAUpR,GACdiR,IAIA7B,IADJ5O,GAEY4O,EAAW5O,GAAGlB,UAAU6J,kBAEhCiG,EAAW5O,GAAG8B,sBAAsBvC,KAAKqR,EAASvE,GAIpDF,EAAIc,iBAAkB,IAIrBjN,EAAI,EAAGA,EAAI4O,EAAW3O,OAAQD,IACjC,GAAI4O,EAAW5O,IACH4O,EAAW5O,GAAGlB,UAAU6J,mBAE5B8H,IACFnE,GAAY,GAEdsC,EAAW5O,GAAG8B,sBAAsBvC,KAAKqR,EAASvE,IAC7CoE,GAAW,CACdtE,EAAIc,iBAAkB,EACtB,MAYR,OANKwD,GAAanE,IAAgBmE,IAActE,EAAIc,mBAClDyD,IACIlV,EAAKyB,OAAOoC,SAASsN,SACvB1H,OAAO2H,aAAaT,EAAIU,kBAGrBV,EAAIO,kBAAkBxN,SA4E7B8R,IAAK9D,EAEL+D,YAnEa,WACb,OAAOzG,GAoEP0G,YA1Da,SAAUC,GACvB3G,EAAY2G,EACZ,IAAIvC,EAAa1B,IACb0B,GAAkC,EAApBA,EAAW3O,QAC3B2O,EAAWwC,QAAQ,SAAUC,GACvBA,GAAOA,EAAIlK,QAAUkK,EAAIlK,OAAOH,KAAK,aACvCxL,EAAK2D,cAAcL,UAAUsE,KAAKiO,EAAInV,OAAQ,gBAAiB,CAAC,WAAYiV,OA4DlFhK,OAAQ/I,EAAQkI,SAShBgL,UAAWtF,EAAWjM,MAOtBoC,QAASzE,EAASqC,MAOlBwR,UAAWvG,EAAWjL,MAOtByR,UAAWlG,EAAWvL,MAGtBjB,UAAW,CACT2S,OApnBe,SAAUtV,GAC3B,IAAI2P,EAAYH,EAAUxP,GAE1B,SAAI2P,IAAaA,EAAU5M,UACrB1D,EAAKyB,OAAOoC,SAASsN,SACvB1H,OAAO2H,aAAad,EAAUnE,SAEhCmE,EAAU8D,MAAQ,SAElB9E,EAAgBgB,EAAU5P,MAAQ,IAAIV,EAAKS,UAAU6P,EAAU5P,KAAM4P,EAAU3P,OAAQ2P,EAAU1P,KAAM0P,EAAUzP,SAAUyP,EAAUxP,QAASoB,GAC9IoN,EAAgBgB,EAAU5P,MAAM4C,UAAU6J,kBAAmB,EAEzDmD,EAAUgC,aACZhD,EAAgBgB,EAAU5P,MAAM4R,WAAahC,EAAUgC,YAGrDhC,EAAU4F,gBACZ5G,EAAgBgB,EAAU5P,MAAM4C,UAAU2I,eAAejM,EAAKyB,OAAOC,UAAUe,eAAe0T,WAAYnW,EAAKyB,OAAOoC,SAASpB,eAAe2T,WAAWrS,KACrJ,SAAUC,KAEV,SAAUd,GACR,IAAImT,EAAO/G,EAAgBgB,EAAU5P,MACjC2V,GACFA,EAAKpQ,YAAY,CAAE/C,OAAQ,yBAI9BqM,EAAkBe,EAAU5P,MAEnC4P,EAAU5M,QAAQsC,UAGlBwK,EAAWzG,OAAO,CAAErJ,KAAM4P,EAAU5P,OAAQ,GAErC,KAmlBP4V,QApWgB,SAAU3V,GAC5B,IAAI2P,EAAYH,EAAUxP,GAEtB2P,IACEtQ,EAAKyB,OAAOoC,SAASsN,SACvB1H,OAAO2H,aAAad,EAAUnE,SAEhCmE,EAAU8D,MAAQ,WAClB9D,EAAU5M,QAAQF,OAAO,IAAIxD,EAAKyD,OAAO,QAErC6M,EAAU3P,SACZ2P,EAAU3P,OAAOW,IAAM,cACnBgP,EAAU3P,OAAOgP,aACnBR,GAA8B,EAC9BmB,EAAU3P,OAAOgP,WAAWC,YAAYU,EAAU3P,SAEpD2P,EAAU3P,OAAS,MAIrBoP,EAAeO,EAAU5P,KAAM,WAAY,iDAAiD,UAErF6O,EAAkBe,EAAU5P,QA+UnC6C,OAAQkM,EACR8G,SAAUpG,EACVpE,2BAtZ2B,SAAUrL,EAAMgQ,GAC5C,IACGE,EAAU6B,EAAO9B,EApBjBnG,EAmBC8F,EAAYoB,EAAK,CAAEhR,KAAMA,IAG7B,GAAI4P,EAAW,CAIb,IAHAM,EAAWN,EAAUhN,UAAU6J,qBAC/BmD,EAAUhN,UAAU6J,iBAAmBuD,GAGrC,OAIF,IAAK+B,KA5BgB,EAFTf,EAAK,CAAEQ,QADlB1H,GAAM,KAGK/F,SACb+F,GAAM,GAGR5H,EAAQiJ,IAAI,QAAS,UAAWrB,EAAK,WAwBpB6E,EACRA,EAAiBvG,eAAe2J,KAClC9B,EAAMtB,EAAiBoD,IACkD,EAArEzS,EAAKsD,UAAU8B,MAAMC,QAAQsL,EAAI+B,uBAAwBhS,EAAM,IACjE+P,EAAiC/P,EAAMgQ,EAAeC,EAAKL,EAAWM,MAsY7E4F,2BAvX0B,SAAU9V,GACtC,IAAI4P,EAAYoB,EAAK,CAAEhR,KAAMA,IAC7B,GAAI4P,EACF,OAAOA,EAAUhN,UAAU6J,iBAE7B,MAAM,IAAInN,EAAKyW,UAAU,OAmXvBC,cAAe3G,EACfiE,YAl0BW,SAAUtT,GACvB,IAAIiW,EAAanJ,SAASoJ,iBAAiB,gBAAkBlW,EAAO,MAClEmW,EAAgB,KAChBC,EAAmB,KAErB,GAAwB,EAApBH,EAAWlS,SACbqS,EAAmB9W,EAAK0B,UAAU8T,IAAI,CAAE9U,KAAMA,eACdV,EAAKS,UACnC,IAAKoW,KAAiBF,EACpB,GAAIA,EAAW7N,eAAe+N,IACxBC,EAAiBxT,UAAU3C,SAAWgW,EAAWE,GACnD,OAAO,EAOjB,OAAO,KA3MM,GAsgCjB7W,EAAK0B,UAAU8G,QAAU,QAezBxI,EAAKiJ,WAAa,SAAU8N,EAAMC,GAMhC,IAAIzW,EAAS,GACT0W,EAAwB,GAExBC,EAAaH,EAEbI,EAASH,EAETI,EAA2B,GAmB3BC,EAAO,SAAU3W,GACf,OAA0D,GAAlDV,EAAKsD,UAAU8B,MAAMC,QAAQ6R,EAAYxW,IA8BnD4W,EAAiC,SAAU5W,EAAM6W,EAAU/T,GACzD,IAAIgB,EAEJ,IAAKA,EAAI4S,EAAyB3S,OAAS,EAAQ,GAALD,EAAQA,IAChD4S,EAAyB5S,GAAG9D,OAASA,IAClC8C,EAIH4T,EAAyB5S,GAAGrB,MAAMK,OAAO+T,GAHzCH,EAAyB5S,GAAGrB,MAAM6C,QAAQuR,GAK5CH,EAAyB1S,OAAOF,EAAG,KAgDzCP,EAAa,SAAUC,EAAQC,EAAMgH,GACnC,OAAOnL,EAAK2D,cAAcL,UAAUM,UAAUuT,EAAOzW,OAAQV,EAAKyB,OAAOoC,SAASO,MAAMC,UAAW,OAAQ,CAACH,EAAQC,EAAMgH,KAkEhInK,KAAKoI,KAxKO,WACN,OAAO8N,GAwKblW,KAAKgL,SAxGW,SAAUtL,GACpB,IAAIyC,EAAQ,IAAInD,EAAKoD,MAuBrB,OApBI7C,EAAOG,GACTyC,EAAM6C,QAAQzF,EAAOG,IAEd2W,EAAK3W,IAjDiB,SAAU8W,GACzC,IAAIhT,EACJ,IAAKA,EAAI,EAAGA,EAAI4S,EAAyB3S,OAAQD,IAC/C,GAAI4S,EAAyB5S,GAAG9D,OAAS8W,EACvC,OAAO,EAGX,OAAO,EA2CAC,CAA+B/W,IAClCyW,EAAO7T,UAAUiJ,sBAAsB7L,GAAMqD,KACzC,SAAUC,GACRsT,EAA+B5W,EAAMsD,GAAO,GAC5ChE,EAAK2D,cAAcL,UAAUsE,KAAKuP,EAAOzW,OAAQ,iBAAkB,CAACA,KAEtE,SAAUwC,GACRoU,EAA+B5W,EAAMwC,GAAQ,KAGrDkU,EAAyB3P,KAAK,CAAE/G,KAAMA,EAAMyC,MAAOA,KAGnDA,EAAMK,OAAO,IAAIxD,EAAKyD,OAAO,QAGxBN,EAAMO,SAiFnB1C,KAAK0W,IAAML,EAEXrW,KAAKsC,UAAY,CACfkJ,gBA3DqB,SAAU9L,EAAM0H,EAAKC,GACtC,IACInE,EAEA2E,EAEAtE,EACAoT,EANAxM,EAAM,GAIN3G,EAAI,EAIR,IAAKjE,EAAOG,GAAO,CAEjB,IAAKwD,KAAUkE,EACTA,EAAIU,eAAe5E,KAErB2E,EAAK,oBADET,EAAIlE,GAAQ6E,KAAK,MACU,2EAA6E7E,EAAS,eAAiBxD,EAAO,wCAEhJyK,EAAIjH,GAAU,IAAK8E,SAAS,MAAO,KAAMH,EAA3B,CAAgC7H,KAAMiD,IAMxD,IAAKO,EAAI,EAAGA,EAAI6D,EAAO5D,OAAQD,IAC7BD,EAAQ8D,EAAO7D,GACfmT,EAAQ,IAAI3X,EAAKmC,SAASC,UAAUmC,GACpC0S,EAAsBvW,GAAQuW,EAAsBvW,IAAS,GAC7DuW,EAAsBvW,GAAM6D,GAASoT,EACrCxM,EAAI5G,GAASoT,EAAMpT,MAGrBhE,EAAOG,GAAQyK,IA8BrBH,KAhBe,SAAUlG,EAAWP,EAAO4G,GACnC8L,EAAsB9L,IAAQ8L,EAAsB9L,GAAKrG,IAC3DmS,EAAsB9L,GAAKrG,GAAWiF,OAAOxF,MA6BvDvE,EAAKmJ,UAMClJ,EAAY,GACfC,EAAkB,GACjBC,EAA4B,GAC7BC,EAAY,GAOZC,EAAoB,IAAIL,EAAKmC,SAASC,UAAU,oBAOhD9B,EAAoB,IAAIN,EAAKmC,SAASC,UAAU,qBAEhD7B,EAAS,GAyHTC,EAAW,SAAUgS,EAAe1N,EAAWgI,GAChD,OAAO,SAAUvI,GACfvE,EAAK2D,cAAcL,UAAU0H,KAAKwH,EAAe1N,EAAWP,EAAOuI,KAgO9D,CAGR1D,KArVU,SAAUwO,GACnB,IAAIC,EAAW,GACbC,EAAa,GACbpL,EAAc,GACdqL,GAAW,EAEb,IAAKrL,KAAezM,EAClB,GAAIA,EAAU6I,eAAe4D,GAC9B,GAAuB,iBAAZkL,EAAsB,CAE/B,IAAKC,KADLE,GAAW,EACMH,EAClB,GAAIA,EAAQ9O,eAAe+O,GAAW,CACpC,QAAsD,IAA3C3X,EAAgBwM,GAAamL,GAGnC,CACNE,GAAW,EACX,MAJAA,EAAWA,GAAa7X,EAAgBwM,GAAamL,KAAcD,EAAQC,GAQvEE,GACLD,EAAWrQ,KAAKiF,QAIfoL,EAAWrQ,KAAKiF,GAInB,OAAOoL,GAwTRE,SAtRc,SAAUtX,EAAMoM,EAAS8K,EAASK,GAC/C,IAAIC,EAAc,GAAIC,EAAqB,KAE3C,IAAKzX,IAASA,EAAK0X,MAAM,oBACvB,OAAO,EAET,GAAInY,EAAUS,GACZ,OAAO,EAIT,GAFAT,EAAUS,GAAQoM,EAClB5M,EAAgBQ,GAAQ,GACpBkX,GAA+B,iBAAZA,EACrB,IAAKM,KAAeN,EACfA,EAAQ9O,eAAeoP,KACzBhY,EAAgBQ,GAAMwX,GAAeN,EAAQM,IAmBlD,OAfAhY,EAAgBQ,GAAiB,YAAMoM,aAAmB9D,UACR,kBAAvC9I,EAAgBQ,GAAiB,YAC1CR,EAAgBQ,GAAiB,WAAI,GAEnCuX,IACEA,aAAiBjP,UACnBmP,EAAqBF,EACrB9X,EAA0BO,GAAQ,IAAIyX,GAGtChY,EAA0BO,GAAQuX,IAK/B,GAsPR1O,QA/SY,SAAUmD,GACnB,OAAOxM,EAAgB4I,eAAe4D,GAAexM,EAAgBwM,GAAe,IA+SvF2L,SAtSe,SAAU3X,GACpB,OAAOP,EAA0B2I,eAAepI,GAAQP,EAA0BO,GAAQ,MAsS/F4X,iBAAkBjY,EAAkBkE,MACpCgU,iBAAkBjY,EAAkBiE,MAGpCjB,UAAW,CACTmJ,oBA/NuB,SAAU/L,EAAM4P,GACxC,IACCkI,EAKAC,EANGlQ,EAAavI,EAAKsD,UAAU8B,MAAMsT,oBAAoBzY,GAGzD0Y,EAAcrI,EACdsI,EAAc,IAAI5Y,EAAKoD,MACvByV,EAAe,IAAI7Y,EAAKoD,MAExB0V,EAAW9Y,EAAKsD,UAAU8B,MAAMoE,cAChCuP,EAAezI,EA2FhB,OAzFItQ,EAAKsD,UAAU8B,MAAMoC,QAAQmR,KAChCA,EAAc9J,KAAKC,UAAU6J,IAI9BF,EAAiBI,EAAanV,QAAQK,KAAK,SAAUiV,GACpD,IAECC,EAEAC,EAJG9Q,EAAM,GACTC,EAAS,GAET8Q,EAAcnZ,EAAKsD,UAAU8B,MAAMoE,eAAiB,CAAC,UAGrD,GAAuB,iBAAZwP,GAAgD,iBAAjBA,EAAQtY,KACnD,OAAOsY,EAGN,IAAKC,KAAYD,EACdA,EAAQlQ,eAAemQ,KAEQ,mBAAtBD,EAAQC,GACf7Q,EAAI6Q,GAAYjZ,EAAKsD,UAAU8B,MAAMgU,kBAAkBJ,EAAQC,IAG5B,iBAAtBD,EAAQC,IACvBD,EAAQC,GAAmB,WACY,IAAvCD,EAAQC,GAAUpS,UAAUpC,SAE/ByU,EAAO1Y,EAASmY,EAAaM,EAAUvY,GACvCsY,EAAQC,GAAUpS,UAAUqS,GAC5B9Y,EAAUqH,KAAK,CAAE6I,UAAWqI,EAAaM,SAAUA,EAAUI,QAASH,EAAM3U,MAAOyU,EAAQC,KAC3F5Q,EAAOZ,KAAKwR,KAIZ,MAAO,CAAEvY,KAAMA,EAAM0H,IAAKA,EAAKC,OAAQA,EAAQiR,SAAUH,IACxD,SAAUjW,GAAU,MAAMA,IAGyB,GAAlDlD,EAAKsD,UAAU8B,MAAMC,QAAQkD,EAAY7H,OAC3C8X,EAASvY,EAAUS,cACesI,YAEnCzI,EAAOoY,GAAgBpY,EAAOoY,IAAgB,GAC1CpY,EAAOoY,GAAajY,GACtB8X,EAASjY,EAAOoY,GAAajY,IAE7B8X,EAAS,IAAIvY,EAAUS,GAAMiY,GAC7BpY,EAAOoY,GAAajY,GAAQ8X,EACX,OAAbM,GACHA,EAASrU,OAAS,IAAMsU,EAAatU,QAEtB,OAAbqU,IACFA,EAAW,CAAC,WAEdC,EAAeA,EAAa1G,WAAWkH,UAAUT,EAASzG,WAAW5N,OAAS,EAAGsU,EAAa1G,WAAW5N,QACzGpE,EAAkB0J,OAAO,CAAEuG,UAAWyI,EAAcjM,QAASpM,EAAMmJ,SAAU2O,MAG7EO,EAAelK,KAAKC,UAAUiK,GAC9B1Y,EAAkB0J,OAAO,CAAEuG,UAAWyI,EAAcjM,QAASpM,EAAMmJ,SAAU2O,EAAQgB,WAAW,OAKhGf,EAAe1U,KAAK,SAAU0V,GAC/Bb,EAAY5S,QAAQyT,IAChB,SAAUvW,GACd0V,EAAYpV,OAAON,KAElB2V,EAAa7S,QAAQwS,IAEe,iBAAtBxY,EAAK4J,IAAIC,SACvB7J,EAAK4J,IAAIC,SAASX,SAAS5F,UAAUoW,iBAAiBhZ,EAAM4P,GAAWvM,KACxE,SAAUC,GACR6U,EAAa7S,QAAQhC,GACrByU,EAAe1U,KAAK,SAAU0V,GAC/Bb,EAAY5S,QAAQyT,IAChB,SAAUvW,GACd0V,EAAYpV,OAAON,MAGpB,SAAUA,GACR0V,EAAYpV,OAAON,KAKpB0V,EAAYpV,OAAO,IAAIxD,EAAKyD,OAAO,QAE9BmV,EAAYlV,SA4HlBkL,eAlHkB,SAAU4D,GAC3B,IAQCmH,EACArJ,EACAyI,EAVGa,EAAmBzH,OAAOuG,oBAAoBnY,GACjDsZ,EAAU,CAACrH,GACXhO,EAAI,EACJsV,EAAajL,KAAKkL,MAAMvH,GACxBwH,EAAW,GACXC,GAAW,EACXC,EAAI,EACJC,EAAK,KAILrB,EAAW9Y,EAAKsD,UAAU8B,MAAMoE,cAEnC,IAAKhF,EAAI,EAAGA,EAAIoV,EAAiBnV,OAAQD,IACvC,GAAIoV,EAAiBpV,GAAGC,OAAS+N,EAAc/N,SAChDuV,EAAWnL,KAAKkL,MAAMH,EAAiBpV,KAC1BC,OAASqV,EAAWrV,OAAQ,CAEvC,IADAwV,GAAW,EACNC,EAAI,EAAGA,EAAIJ,EAAWrV,QAAUwV,EAAUC,IAC5CJ,EAAWI,KAAOF,EAASE,KAC7BD,GAAW,GAGRA,GACLJ,EAAQpS,KAAKmS,EAAiBpV,IAKhC,IAAK0V,EAAI,EAAGA,EAAIL,EAAQpV,OAAQyV,IAAK,CAInC,IAHA5J,EAAYuJ,EAAQK,GACpBC,EAAK5Z,EAAO+P,GAEP9L,EAAIpE,EAAUqE,OAAS,EAAQ,GAALD,EAAQA,IACpCpE,EAAUoE,GAAG8L,YAAcA,IACzBlQ,EAAUoE,GAAGD,MAAMsD,aACxBzH,EAAUoE,GAAGD,MAAMsD,YAAYzH,EAAUoE,GAAG6U,SAE3CjZ,EAAUsE,OAAOF,EAAG,IAGrB,GAAI2V,EAGL,IAFAR,EAAmB3Z,EAAKsD,UAAU8B,MAAMsT,oBAAoByB,GAC5DpB,EAAelK,KAAKkL,MAAMzJ,GACrB9L,EAAI,EAAGA,EAAImV,EAAiBlV,OAAQD,IACtB,OAAbsU,GACHA,EAASrU,OAAS,IAAMsU,EAAatU,QAEtB,OAAbqU,IACFA,EAAW,CAAC,WAEdC,EAAeA,EAAa1G,WAAWkH,UAAUT,EAASzG,WAAW5N,OAAS,EAAGsU,EAAa1G,WAAW5N,QACzGnE,EAAkByJ,OAAO,CAAEuG,UAAWyI,EAAcjM,QAAS6M,EAAiBnV,OAI9EuU,EAAelK,KAAKC,UAAUiK,GAC9BzY,EAAkByJ,OAAO,CAAEuG,UAAWyI,EAAcjM,QAAS6M,EAAiBnV,GAAIgV,WAAW,YAErFjZ,EAAO+P,GAAWqJ,EAAiBnV,MAuD5CwI,WAtCc,SAAUoN,EAAetN,EAAS5I,EAAQC,GACvD,IACCqG,EAAM,KACN8F,EAAY8J,EAcf,OAZIpa,EAAKsD,UAAU8B,MAAMoC,QAAQ8I,KAC/BA,EAAYzB,KAAKC,UAAUsL,IAGzB7Z,EAAO+P,IAAc/P,EAAO+P,GAAWxD,GAEzCtC,EADMjK,EAAO+P,GAAWxD,GACd5I,GAAQ2L,MAAM/C,EAAS3I,GAExBlE,EAAU6M,KAEnBtC,EADMvK,EAAU6M,GACN5I,GAAQ2L,MAAM/C,EAAS3I,IAE5BqG,MA2BExK,GAGT,IACE,GAAuB,oBAAXqa,aAAsD,IAAnBA,OAAOC,QAA0B,CAC9E,IAAIC,EAAkBC,QAAQ,cACqB,iBAAxCD,EAAgBnI,UAAU1Q,WACnC3B,EAAoBwa,EAAgBnI,WAEtCiI,OAAOC,QAAUC,EACjBF,OAAOC,QAAiB,QAAID,OAAOC,aAEhC,GAAyB,oBAAbG,UAA6BA,SAASC,IAAI5R,eAAe,cACxE6R,OAAO,kBAAmB,CAAC,cAAe,SAAUC,GAIlD,MAHwC,iBAA7BA,EAAKxI,UAAU1Q,WACxB3B,EAAoB6a,EAAKxI,WAEpBwI,QAGN,CAAA,GAAuB,mBAAXD,aAAiD,IAAfA,OAAOE,KAC5B,oBAAdC,gBAA4F,IAAtDA,UAAUC,EAAEC,SAASC,EAAEC,OAAOC,MAAM,cASxF,MAAM,IAAIC,MAAM,kBARhBT,OAAO,kBAAmB,CAAC,cAAe,SAAUC,GAIlD,MAHwC,iBAA7BA,EAAKxI,UAAU1Q,WACxB3B,EAAoB6a,EAAKxI,WAEpBwI,KAOb,MAAOrG,GACsD,iBAAhD9K,OAAOzJ,KAAKqb,YAAYjJ,UAAU1Q,WAC3C3B,EAAoB0J,OAAOzJ,KAAKqb,YAAYjJ,YA1vFlD","file":"swac-container.min.js","sourcesContent":["/* Version 1.5.1, copyright (C) 2019, Siemens AG. All Rights Reserved. */\r\n\r\n\r\n(function () {\r\n  var swacContainerModule = function (SWAC) {\r\n\r\n///////////////////////////////////////////\r\n// lib/container/component.js\r\n\r\n\r\n/**\r\n * Class that manages component \r\n *\r\n * @class SWAC.Component\r\n * @constructor\r\n * @param {string} name Name of the component.\r\n * @param {object} iframe Corresponding iframe instance the component is hosted in.\r\n * @param {object} type Type of the component.\r\n * @param {object} settings settings property bag.\r\n * @param {string} lastUrl last URL of component.\r\n */\r\nSWAC.Component = function (name, iframe, type, settings, lastUrl) {\r\n\r\n  //////////////\r\n  // PRIVATE   //\r\n  //////////////\r\n\r\n  var\r\n\t_that = this,\r\n\r\n\t_rootnode = null,\r\n\r\n\t_name = name,\r\n\r\n\t/**\r\n\t  * Corresponding iframe instance the component is hosted in\r\n\t  *\r\n\t  * @protected\r\n\t  * @property iframe\r\n\t  * @type object\r\n\t  */\r\n\t_iframe = iframe,\r\n\r\n\t  /**\r\n\t  * Type of the component as specified during creation.\r\n\t  *\r\n\t  * @method type\r\n\t  * @type string\r\n\t  */\r\n\t_type = function () { return type; },\r\n\r\n\t// Original settings property bag.\r\n\t_settings = settings,\r\n\r\n\t_lastUrl = ((lastUrl !== '') && (lastUrl !== null) && (lastUrl !== undefined)) ? lastUrl : iframe.src,\r\n\r\n  _addDpcValues = ((typeof _settings !== 'undefined') && (typeof _settings.addDpcValues !== 'undefined')) ? _settings.addDpcValues : SWAC.Config.Container.Behaviors.AddDpcValues,\r\n\r\n\t_containerOnReadyEvent = arguments[5],\r\n\r\n\t_interfaces = null, // will be set in _beginExpose\r\n\r\n\t/**\r\n\t* Component's last isDirtyValue.\r\n\t*\r\n\t* @protected\r\n\t* @property lastIsDirtyValue\r\n\t* @type boolean\r\n\t* @return {Boolean} returns last isDirtyValue of component\r\n\t*/\r\n\t_lastIsDirtyValue = false,\r\n\r\n  _visibility = 'hidden', // Initial state\r\n\r\n  // Turns dirty when the original component got removed but this remote proxy may still exist.\r\n  _dirty = false,\r\n\r\n  /**\r\n  * Fired when API got exposed and component is fully operative.\r\n  *\r\n  * @event onReady\r\n  */\r\n  _onReady = new SWAC.Eventing.Publisher('onReady'),\r\n\r\n  _supportedMouseEventList = 'click dblclick mousedown mousemove mouseup',\r\n\r\n  // list of registered events\r\n  _registeredEventList = [],\r\n\r\n  // this is the DPC accessor the framework is working on. (Won't result in forwarding towards container, avoiding loop)\r\n  _privateDpc = {},\r\n\r\n  // Authentication object\r\n  _authentication = new SWAC.Authentication(name),\r\n\r\n  /**\r\n  * Provides access to component APIs: methods and events\r\n  *\r\n  * @property proxy\r\n  * @type object\r\n  */\r\n  _proxy = {},\r\n\r\n  // Object use to take reference of SWAC.Eventing.Publisher used for component events\r\n  _eventPublishers = {},\r\n\r\n  /**\r\n  * Provides access to internal component status dpc structure\r\n  *\r\n  * @property status\r\n  * @type object\r\n  */\r\n  _status = {},\r\n\r\n  /**\r\n  * Provides the accessor to the component dpc structure\r\n  *\r\n  * @property dpc\r\n  * @type object\r\n  */\r\n  _dpc = {},\r\n\r\n  // Unique ID for this component instance in the container\r\n  _id = SWAC.Guid.generate(),\r\n\r\n  /**\r\n   * Sets the visibility of the component.\r\n   *\r\n   * @method beginShow\r\n   * @param {bool} visible the component is visible or not.\r\n   * @return {object} an object defer.promise.\r\n   */\r\n\t  _beginShow = function (visible) {\r\n\t    var defer = new SWAC.Defer(),\r\n        newstate = visible ? 'visible' : 'hidden',\r\n        change;\r\n\r\n\t    if (_dirty) {\r\n\t      defer.reject(new SWAC.Reason(13001));\r\n\t    } else {\r\n\t      if (_settings.flavor !== 'ui') {\r\n\t        defer.reject(new SWAC.Reason(13002));\r\n\t      } else if (newstate === _visibility) {\r\n\t        defer.fulfill();\r\n\t      } else {\r\n\t        change = function (value) {\r\n\t          _visibility = newstate;\r\n\r\n\t          _iframe.style.width = (visible ? _settings.width : '0px');\r\n\t          _iframe.style.height = (visible ? _settings.height : '0px');\r\n\t          _iframe.style.display = (visible ? 'block' : 'none');\r\n\t        };\r\n\r\n\t        // Send notification to hosted component\r\n\t        return SWAC.Communication._internal.beginCall(_name, SWAC.Config.TimeOuts.Internal, 'show', [visible]).then(change, change); // Turn visible once the component returned from its event handlers.\r\n\t      }\r\n\t    }\r\n\t    return defer.promise;\r\n\t  },\r\n\r\n\t  /**\r\n\t  * Removes the component.\r\n\t  *\r\n\t  * @method beginRemove\r\n\t  * @param {Object} reason the reason for component removal.\r\n\t  * @return {object} an object defer.promise.\r\n\t  */\r\n\t  _beginRemove = function (reason) {\r\n\t    var defer = new SWAC.Defer(),\r\n        clean = function () {\r\n          SWAC.Container._internal.remove(_name, _iframe, reason);\r\n          _iframe = null;\r\n          _dirty = true;\r\n          _proxy = null;\r\n          _status = null;\r\n          _dpc = null;\r\n          _eventPublishers = null;\r\n          _interfaces = null;\r\n        };\r\n\r\n\t    if (_dirty) {\r\n\t      defer.reject(new SWAC.Reason(13001));\r\n\t    } else {\r\n\t      // Send remove message to component and remove iframe on resolved promise.\r\n\t      return SWAC.Communication._internal.beginCall(_name, SWAC.Config.TimeOuts.Remove, 'remove', [reason]).then(\r\n           function (value) {\r\n             clean();\r\n           },\r\n           function (reason) {\r\n             clean();\r\n             throw reason;\r\n           }\r\n         );\r\n\t    }\r\n\t    return defer.promise;\r\n\t  },\r\n\r\n\t  /**\r\n\t  * Request of clean up for the component\r\n\t  *\r\n\t  * @method beginCleanUpRequest\r\n\t  * @return {Object} defer.promise return a defer object (to be fullfilled or rejected).\r\n\t  */\r\n\t  _beginCleanUpRequest = function () {\r\n\t    return SWAC.Communication._internal.beginCall(_name, SWAC.Config.TimeOuts.CleanUp, 'cleanUp', [], true);\r\n\t  },\r\n\r\n\t  /**\r\n\t * Moves and resizes the component.\r\n\t *\r\n\t * @method beginPosition\r\n\t * @param {String} left left position.\r\n\t * @param {String} top top position.\r\n\t * @param {String} width width size.\r\n\t * @param {String} height height size.\r\n\t * @return {object} an object defer.promise.\r\n\t */\r\n\t  _beginPosition = function (left, top, width, height) {\r\n\t    var defer = new SWAC.Defer();\r\n\r\n\t    if (_dirty) {\r\n\t      defer.reject(new SWAC.Reason(13001));\r\n\t      return defer.promise;\r\n\t    }\r\n\r\n\t    if (_settings.flavor !== 'ui') {\r\n\t      defer.reject(new SWAC.Reason(13002));\r\n\t      return defer.promise;\r\n\t    }\r\n\r\n\t    // Do not change iframe properties when hidden, but send event afterwards.\r\n\t    if (_visibility !== 'hidden') {\r\n\t      _iframe.style.left = left;\r\n\t      _iframe.style.top = top;\r\n\t      _iframe.style.width = width;\r\n\t      _iframe.style.height = height;\r\n\t    }\r\n\r\n\t    // Send notification to hosted component\r\n\t    return SWAC.Communication._internal.beginCall(_name, SWAC.Config.TimeOuts.Internal, 'position', [left, top, width, height]);\r\n\t  },\r\n\r\n\t  /**\r\n\t * Get position and size of the component.\r\n\t *\r\n\t * @method getPosition\r\n\t * @return {object} returns an object containing the following properties:\r\n\t * @return {String} left left position.\r\n\t * @return {String} top top position.\r\n\t * @return {String} width width size.\r\n\t * @return {String} height height size.\r\n\t */\r\n\t  _getPosition = function () {\r\n\t    if (_dirty) {\r\n\t      return null;\r\n\t    }\r\n\t    else {\r\n\t      return {\r\n\t        left: _iframe.style.left,\r\n\t        top: _iframe.style.top,\r\n\t        width: _iframe.style.width,\r\n\t        height: _iframe.style.height\r\n\t      };\r\n\t    }\r\n\t  },\r\n\r\n  /**\r\n  * Create a message for calling a method from container to component\r\n  *\r\n  * @private\r\n  * @method _beginCall\r\n  * @param {string} method method to call\r\n  * @param {object} args method's argument\r\n  * @return {object} an object defer.promise.\r\n  */\r\n\t  _beginCall = function (method, args) {\r\n\t    return SWAC.Communication._internal.beginCall(_name, SWAC.Config.TimeOuts.Proxy.Functions, 'call', [method, args]);\r\n\t  },\r\n\r\n\t /**\r\n\t* Asyncronous method for getting the interface\r\n\t*\r\n\t* @protected\r\n\t* @method beginRequestInterface\r\n\t* @param {string} name name of the interface\r\n\t* @return {object} an object defer.promise.\r\n\t*/\r\n\t  _beginRequestInterface = function (name) {\r\n\t    var defer = new SWAC.Defer();\r\n\r\n\t    SWAC.Communication._internal.beginCall(_name, SWAC.Config.TimeOuts.Internal, 'beginRequestInterface', [name]).then(\r\n        function (inf) {\r\n          if (inf) {\r\n            _interfaces._internal.exposeInterface(inf.name, inf.api, inf.events);\r\n            _interfaces.beginGet(name).then(\r\n              function (value) {\r\n                defer.fulfill(value);\r\n              },\r\n              function (reason) {\r\n                defer.reject(reason);\r\n              });\r\n          }\r\n          else {\r\n            defer.reject(new SWAC.Reason(14001));\r\n          }\r\n        },\r\n        function (reason) {\r\n          defer.reject(reason);\r\n        });\r\n\r\n\t    return defer.promise;\r\n\t  },\r\n\r\n\t  /**\r\n\t  * Asyncronous method for getting the service\r\n\t  *\r\n\t  * @protected\r\n\t  * @method beginRequestService\r\n\t  * @param {string} serviceName name of the service\r\n\t  * @return {object} an object defer.promise.\r\n\t  */\r\n\t  _beginRequestService = function (serviceName) {\r\n\t    // Promise is created/managed by SWAC.Services, no chaining necessary here.\r\n\t    var newCmpName = this.o;\r\n\t    return SWAC.Services._internal.beginRequestService(serviceName, newCmpName);\r\n\t  },\r\n\r\n\t   /**\r\n\t  * Method for calling a service method\r\n\t  *\r\n\t  * @protected\r\n\t  * @method callService\r\n\t  * @param {string} method method to call\r\n\t  * @param {object} args method's argument\r\n\t  * @param {string} service service's name\r\n\t  * @return {object} the return value of service method.\r\n\t  */\r\n\t  _callService = function (method, args, service) {\r\n\t    var newsource = [];\r\n\t    if (this.o) {\r\n\t      newsource = this.o;\r\n\t    }\r\n\t    return SWAC.Services._internal.callMethod(newsource, service, method, args);\r\n\t  },\r\n\r\n\t  /**\r\n\t  * Create the forwarder\r\n\t  *\r\n\t  * @private\r\n\t  * @method _createForwarder\r\n\t  * @return {function} the function to forward.\r\n\t  */\r\n\t  _createForwarder = function () {\r\n\t    return function (key, type, content) {\r\n\t      var res = null;\r\n\r\n\r\n\t      if (type === 'add' || type === 'set' || type === 'remove') {\r\n\t        // Fire and forget here\r\n\t        SWAC.Communication._internal.dpcChanged(_name, key, type, content);\r\n\t      }\r\n\t      else if (type === 'get') {\r\n\t        // Return promise for get-call\r\n\t        return SWAC.Communication._internal.beginDpcGet(_name, key);\r\n\t      }\r\n\t      else if (type === 'beginset') {\r\n\t        if ((SWAC._internal.Utils.checkVersion(_that.swacVersion, '1.1.0') <= 0)) {\r\n\t          res = new SWAC.Defer();\r\n\t          SWAC.Communication._internal.dpcChanged(_name, key, 'set', content);\r\n\t          res.fulfill({ modified: false });\r\n\t          return res.promise;\r\n\t        }\r\n\t        else {\r\n\t          // Return promise for get-call\r\n\t          return SWAC.Communication._internal.beginDpcSet(_name, key, type, content).then(\r\n            function (data) {\r\n              if (typeof data === 'object' && typeof data.modified === 'boolean') {\r\n                return data;\r\n              }\r\n              return { modified: false };\r\n            }, function (reason) {\r\n              throw reason;\r\n            });\r\n\t        }\r\n\t      }\r\n\t    };\r\n\t  },\r\n\r\n\t  /**\r\n\t  * Method that exposes methods, events and dpcs of the component to the container\r\n\t  *\r\n\t  * @protected\r\n\t  * @method _beginExpose\r\n\t  * @param {object} api list of method exported by component\r\n\t  * @param {object} events list of events exported by component\r\n\t  * @param {object} hasPublicDpc list of dpcs exported by component\r\n\t  * @param {object} interfaces list of interfaces\r\n\t  * @param {string} version SWAC library version\r\n\t  * @return {object} an object defer.promise.\r\n\t  */\r\n\t  _beginExpose = function (api, events, hasPublicDpc, interfaces, version) {\r\n\t    var defer = new SWAC.Defer(),\r\n        internalDefer,\r\n    failed,\r\n    proceed,\r\n    flags,\r\n    args,\r\n    fn,\r\n    i = 0,\r\n    event,\r\n    method;\r\n\r\n\t    if (version) {\r\n\t      _that.swacVersion = version;\r\n\t    }\r\n\r\n\t    //// METHODS\r\n\t    for (method in api) {\r\n\t      if (api.hasOwnProperty(method)) {\r\n\t        args = api[method].join(', ');\r\n\t        fn = 'return function (' + args + ') { var myargs = Array.prototype.slice.call(arguments, 0); var args = [\"' + method + '\", myargs ]; return fn.apply( ctx, args ); };';\r\n\t        /* jshint -W054 */\r\n\t        _proxy[method] = (new Function('ctx', 'fn', fn))(_that, _beginCall);\r\n\t        /* jshint +W054 */\r\n\t      }\r\n\t    }\r\n\r\n\t    //// EVENTS\r\n\t    for (i = 0; i < events.length; i++) {\r\n\t      event = events[i];\r\n\t      _eventPublishers[event] = new SWAC.Eventing.Publisher(event);\r\n\t      _proxy[event] = _eventPublishers[event].event;\r\n\t    }\r\n\r\n\t    //// INTERFACES\r\n\t    _that.interfaces = _interfaces = new SWAC.Interfaces(interfaces, _that);\r\n\r\n\t    //// DPCS\r\n\t    failed = function (reason) {\r\n\t      defer.reject(reason);\r\n\t    };\r\n\r\n\t    proceed = function (value) {\r\n\t      var services = SWAC.Services.list(),\r\n        i = 0,\r\n        cntService = [],\r\n            servicesOption = {};\r\n\t      for (i = 0; i < services.length; i++) {\r\n\t        servicesOption[services[i]] = SWAC.Services.getInfo(services[i]);\r\n\t        if (!servicesOption[services[i]]['provider']) {\r\n\t          if (SWAC._internal.Utils.getFullName()) { //support for mixed component performing the service registration before receiving the fullName (e.g.: before swacboot.start)\r\n\t            servicesOption[services[i]]['provider'] = SWAC._internal.Utils.getFullName();\r\n\t          }\r\n\t          else if (typeof window['swacPostMessage'] !== 'function' && window.parent === self) {\r\n\t            servicesOption[services[i]]['provider'] = ['<root>']; //support for top level container that will never have a fullName ... \r\n\t          }\r\n\t          else { //no service delegation without provider info\r\n\t            servicesOption[services[i]]['delegable'] = false;\r\n\t          }\r\n\t        }\r\n\t      }\r\n\t      if (SWAC._internal.Utils.checkVersion(_that.swacVersion, '1.4.0') >= 0) { //service delegation requires swacVersion >= 1.4.0\r\n\t        if (typeof SWAC.Hub.instance === 'object') {\r\n\t          cntService = SWAC.Hub.instance.services.list({ delegable: true });\r\n\t          for (i = 0; i < cntService.length ; i++) {\r\n\t            if (SWAC._internal.Utils.indexOf(services, cntService[i]) === -1) {\r\n\t              servicesOption[cntService[i]] = SWAC.Hub.instance.services.getInfo(cntService[i]);\r\n\t            }\r\n\t          }\r\n\t        }\r\n\t      }\r\n\r\n\t      // Enable prolong also for beginExpose\r\n\t      internalDefer = new SWAC.Defer();\r\n\t      defer.fulfill(internalDefer.promise);\r\n\r\n\t      SWAC.Communication._internal.beginCall(_name, SWAC.Config.TimeOuts.Internal, 'ready', [services, servicesOption]).then(\r\n          function () {\r\n            internalDefer.fulfill();\r\n            _containerOnReadyEvent.notify({ name: _name }, true);\r\n            _onReady.notify({ name: _name }, true);\r\n          },\r\n                  function (reason) {\r\n                    internalDefer.reject(reason);\r\n                  });\r\n\t    };\r\n\r\n\t    flags = SWAC.DPC._internal.Flags.Proxy | SWAC.DPC.Permissions.Write | SWAC.DPC.Permissions.Read;\r\n\r\n\t    _rootnode = new SWAC.DPC.Node(_createForwarder(), _id, flags);\r\n\r\n\t    _privateDpc = _rootnode.access(_id); // internal accessor, full permissions\r\n\r\n\t    SWAC.Communication._internal.beginCall(_name, SWAC.Config.TimeOuts.Internal, 'bind', []).then(\r\n        proceed, failed\r\n      );\r\n\r\n\t    return defer.promise;\r\n\t  },\r\n\r\n  /**\r\n  * Fires an event\r\n  *\r\n  * @protected\r\n  * @method fire\r\n  * @param {string} evtname name of event to fire\r\n  * @param {object} evtobject data of event\r\n  * @param {object} inf interface object\r\n  */\r\n\t  _fire = function (evtname, evtobject, inf) {\r\n\t    if (typeof inf === 'string') {\r\n\t      _interfaces._internal.fire(evtname, evtobject, inf);\r\n\t    } else {\r\n\t      _eventPublishers[evtname].notify(evtobject);\r\n\t    }\r\n\t  },\r\n\r\n  /**\r\n  * Forward dpc action into internal private dpc\r\n  *\r\n  * @protected\r\n  * @method dpcChanged\r\n  * @param {string} key key of dpc node\r\n  * @param {string} type action on dpc node (remove|add|set)\r\n  * @param {object} content content of dpc node action\r\n  */\r\n\t  _dpcChanged = function (key, type, content) {\r\n\r\n\t    var succCallback, publicNode = null;\r\n\r\n\t    if (type === 'remove') {\r\n\t      _privateDpc.remove(key);\r\n\t    } else if (type === 'add') {\r\n\t      {\r\n\t        if (key.toLowerCase().indexOf('private.') !== -1) {\r\n\t          content.flags = content.flags ^ SWAC.DPC.Permissions.Write;\r\n\t        }\r\n\t        if (key === 'public') {\r\n\t          if (_rootnode.open('public') === undefined) {\r\n\t            publicNode = new SWAC.DPC.Node(_rootnode, _id, SWAC.DPC.Permissions.Read | SWAC.DPC.Permissions.Write | SWAC.DPC._internal.Flags.Proxy, 'public');\r\n\t            publicNode.componentVersion = _that.swacVersion;\r\n\t            publicNode.addDpcValues = _addDpcValues;\r\n\t          }\r\n\t        }\r\n\t        else {\r\n\t          _privateDpc.add(key, content.flags);\r\n\t        }\r\n\t        if (key === 'private') {\r\n\t          _status = _rootnode.open('private').access();\r\n\t          _that.status = _status;\r\n\t        }\r\n\t        if (key === 'public') {\r\n\t          _dpc = _rootnode.open('public').access();\r\n\t          _that.dpc = _dpc;\r\n\t        }\r\n\t      }\r\n\t    } else if (type === 'set') {\r\n\t      {\r\n\t        if (key.toLowerCase().indexOf('private.') !== -1) {\r\n\t          if (content.flags & SWAC.DPC.Permissions.Write) {\r\n\t            content.flags = content.flags ^ SWAC.DPC.Permissions.Write;\r\n\t          }\r\n\t        }\r\n\t        _privateDpc.set(key, (_addDpcValues) ? content.value : null, content.type, content.flags); // set (without setting an actual value)\r\n\t        if (!window.addEventListener) {\r\n\t          if ((key === 'private.isDirty') && (typeof (content.value) === 'boolean')) {\r\n\t            SWAC.Container._internal.setComponentInternalStatus(_name, content.value);\r\n\t          }\r\n\t        }\r\n\t      }\r\n\t    }\r\n\r\n\t    if (((type === 'set')) && (key.toLowerCase().indexOf('private.') !== -1)) {\r\n\t      succCallback = function () {\r\n\t        return function (value) {\r\n\t          if (typeof (value) === 'boolean') {\r\n\t            SWAC.Container._internal.setComponentInternalStatus(_name, value);\r\n\t          }\r\n\t        };\r\n\t      };\r\n\t      _rootnode.access().open(key).beginGet().then(succCallback());\r\n\t    }\r\n\t  },\r\n\r\n\t  /**\r\n\t* Closes communication versus component and removes it\r\n\t*\r\n\t* @protected\r\n\t* @method close\r\n\t* @param {string} reason reason for close action\r\n\t*/\r\n\t  _close = function (reason) {\r\n\t    _beginRemove(reason);\r\n\t  },\r\n\r\n\t  /**\r\n  * Initialize handshanke between component and container\r\n  *\r\n  * @protected\r\n  * @method beginHandshake\r\n  * @param {Function} tlsHandler handler to manage TLS\r\n  * @param {Number} timeout handshake timeout\r\n  */\r\n\t_beginHandshake = function (tlsHandler, timeout) {\r\n\t  return _authentication._internal.beginHandshake(tlsHandler, null, timeout);\r\n\t},\r\n\r\n  /**\r\n  * Send TLS message to container\r\n  *\r\n  * @protected\r\n  * @method tlsMessage\r\n  * @param {String} message TLS message to send\r\n  */\r\n\t_tlsMessage = function (message) {\r\n\t  _authentication._internal.receiveMessage(message);\r\n\t},\r\n\r\n   /**\r\n  * Returns current url of component\r\n  *\r\n  * @protected\r\n  * @method getCurrentUrl\r\n  * @return {String} Return last url of component.\r\n  */\r\n  _getCurrentUrl = function () {\r\n    return _lastUrl;\r\n  },\r\n\r\n   /**\r\n  * Set current url of component\r\n  *\r\n  * @protected\r\n  * @method setCurrentUrl\r\n  * @param {String} lastUrl current url\r\n  */\r\n  _setCurrentUrl = function (lastUrl) {\r\n    _lastUrl = lastUrl;\r\n  },\r\n\r\n   /**\r\n  * Returns the html domain of the component\r\n  *\r\n  * @method getDomain\r\n  * @return {string} domain domain of component\r\n  */\r\n  _getDomain = function () {\r\n    return _authentication.getDomain();\r\n  },\r\n\r\n  /**\r\n  * Manage the removeComponent bubbling notification \r\n  * Clean local service references of the component and bubble to the upper level if present\r\n  *\r\n  * @protected\r\n  * @method removeComponentServiceAndBubble\r\n  */\r\n\t_removeComponentServiceAndBubble = function () {\r\n\t  var args = this.o;\r\n\t  SWAC.Services._internal.removeServices(JSON.stringify(args)); //args is the component fullName\r\n\t  if (SWAC._internal.Utils.getFullName()) { // it's null if root\r\n\t    SWAC.Communication._internal.call(null, 'removeComponentServiceAndBubble', null, args);\r\n\t  }\r\n\t},\r\n\r\n  /**\r\n  * Remove the specified event from internal list of registered events\r\n  *\r\n  * @private\r\n  * @method _removeFromRegisteredEventList\r\n  * @param {String} event event name\r\n  */\r\n  _removeFromRegisteredEventList = function (event) {\r\n    var i;\r\n\r\n    for (i = _registeredEventList.length - 1; i >= 0; i--) {\r\n      if (_registeredEventList[i].name === event) {\r\n        _registeredEventList.splice(i, 1);\r\n      }\r\n    }\r\n  },\r\n\r\n  /**\r\n  * Get the specified event from internal list of registered events\r\n  *\r\n  * @protected\r\n  * @method getRegisteredEvent\r\n  * @param {String} event event name\r\n  * @return {Object} registered event item\r\n  */\r\n  _getRegisteredEvent = function (event) {\r\n    var item;\r\n\r\n    for (item in _registeredEventList) {\r\n      if (_registeredEventList[item].name === event) {\r\n        return _registeredEventList[item];\r\n      }\r\n    }\r\n    return null;\r\n  },\r\n\r\n  /**\r\n  * Get an event info object containing registration level and event category\r\n  *\r\n  * @private\r\n  * @method _getEventLevelAndCategory\r\n  * @param {String} eventName event name\r\n  * @return {Object} event info item, level property is an empty string if the event is not supported\r\n  */\r\n   _getEventLevelAndCategory = function (eventName) {\r\n     var eventLevel = {\r\n       level: '',\r\n       category: ''\r\n     },\r\n      nestedMouseEventList = _supportedMouseEventList.split(' ');\r\n\r\n     if (SWAC._internal.Utils.indexOf(nestedMouseEventList, eventName) > -1) {\r\n       // a message will be sent to the component to attach event to the document inside iFrame and propagated to all the inner components\r\n       eventLevel.level = '_nested';\r\n       eventLevel.category = 'MouseEvents';\r\n     }\r\n\r\n     return eventLevel;\r\n   },\r\n\r\n  /**\r\n  * Create the proper event object\r\n  *\r\n  * @private\r\n  * @method _eventAdapter\r\n  * @param {Object} args event arguments\r\n  * @return {Object} event object\r\n  */\r\n  _eventAdapter = function (args) {\r\n    var evtObj = null,\r\n      evt = null;\r\n\r\n    // get event level and its category\r\n    evt = _getEventLevelAndCategory(args.type);\r\n    // if the event is supported check the category and create the proper event object\r\n    if (evt.level !== '') {\r\n      switch (evt.category) {\r\n        case 'MouseEvents':\r\n          evtObj = document.createEvent('MouseEvents');\r\n          evtObj.initMouseEvent(args.type, args.bubbles, args.cancelable, null, args.detail, args.screenX, args.screenY,\r\n          args.clientX, args.clientY, args.ctrlKey, args.altKey, args.shiftKey, args.metaKey, args.button, _iframe);\r\n          break;\r\n      }\r\n    }\r\n    evt = null;\r\n\r\n    return evtObj;\r\n  },\r\n\r\n  /**\r\n  * Manage the received event and fire or notify it to the parent\r\n  *\r\n  * @protected\r\n  * @method manageEvent\r\n  * @param {Object} args event arguments\r\n  */\r\n  _manageEvent = function (args) {\r\n    var evt = null, i,\r\n      regEvent = null;\r\n\r\n    // get the event object from internal register\r\n    regEvent = _getRegisteredEvent(args.type);\r\n\r\n    if (regEvent !== null) {\r\n      // create the proper event object\r\n      evt = _eventAdapter(args);\r\n\r\n      // add a custom property to the event object containing the SWAC Component instance\r\n      evt.SWACComponent = _that;\r\n\r\n      if (regEvent.bubble === true) {\r\n        // fire the event\r\n        _iframe.dispatchEvent(evt);\r\n      }\r\n\r\n      // if the event has been explicitly requested from the parent execute all callback functions\r\n      if (regEvent.callback.length > 0) {\r\n        for (i = 0; i < regEvent.callback.length; i++) {\r\n          if (regEvent.callback[i]) {\r\n            regEvent.callback[i](evt);\r\n          }\r\n        }\r\n      }\r\n\r\n      // if the event is inherited from parent and not inserted from bubble, send a manageEvent message to it\r\n      if (regEvent.inherited && !regEvent.insertFromBubble) {\r\n        SWAC.Communication._internal.call(null, 'manageEvent', [args]);\r\n      }\r\n\r\n      regEvent = null;\r\n      evt = null;\r\n    }\r\n  },\r\n\r\n  /**\r\n  * Subscribe a function to one or more events\r\n  *\r\n  * @method subscribe\r\n  * @param {Function} callback function to call\r\n  * @param {Object} filters one or more event names, if empty the callback is subscribed to all the supported events\r\n  * @return {Boolean} subscribe response\r\n  */\r\n  _subscribeEvent = function (callback, filters) {\r\n    var arrayFilters, i,\r\n      inherited = (arguments.length === 3) ? arguments[2] : false, // hidden parameter filled by parent to support mixed component's events propagation\r\n      _callback,\r\n      registeredEvent = null,\r\n      evtLevel = null,\r\n      eventToEnable = [],\r\n      retVal = false;\r\n\r\n    // old version component cannot manage events\r\n    if ((SWAC._internal.Utils.checkVersion(_that.swacVersion, '1.1.0') <= 0)) {\r\n      return false;\r\n    }\r\n\r\n    if ((typeof callback !== 'function') && !inherited) {\r\n      return false;\r\n    }\r\n\r\n    if (typeof callback !== 'function') {\r\n      _callback = [];\r\n    }\r\n    else {\r\n      _callback = [callback];\r\n    }\r\n\r\n    // array copy to always work with an array parameter\r\n    if ((filters === '') || (filters === null) || (filters === undefined)) {\r\n      arrayFilters = _supportedMouseEventList.split(' ');\r\n    }\r\n    else {\r\n      if (SWAC._internal.Utils.isArray(filters)) {\r\n        arrayFilters = filters;\r\n      }\r\n      else {\r\n        if ((typeof filters) === 'string') {\r\n          arrayFilters = [filters];\r\n        }\r\n      }\r\n    }\r\n\r\n    for (i = 0; i < arrayFilters.length; i++) {\r\n      // get the event object from internal register\r\n      registeredEvent = _getRegisteredEvent(arrayFilters[i]);\r\n\r\n      // get event level and its category\r\n      evtLevel = _getEventLevelAndCategory(arrayFilters[i]);\r\n\r\n      if (registeredEvent === null) {\r\n        // if the event is supported register the event at the appropriate level\r\n        if (evtLevel.level !== '') {\r\n          // event added to list of registered events\r\n          _registeredEventList.push({ name: arrayFilters[i], bubble: false, inherited: inherited, callback: _callback.slice(0) });\r\n          if (evtLevel.level === '_nested') {\r\n            // event added to enable list\r\n            eventToEnable.push(arrayFilters[i]);\r\n          }\r\n          if (!retVal) {\r\n            // at least one event has been successfully registered\r\n            retVal = true;\r\n          }\r\n        }\r\n      }\r\n      else {\r\n        // only one record for a callback\r\n        if (SWAC._internal.Utils.indexOf(registeredEvent.callback, callback) === -1) {\r\n          registeredEvent.callback.push(callback);\r\n        }\r\n\r\n        if (!retVal) {\r\n          // at least one event has been successfully registered\r\n          retVal = true;\r\n        }\r\n\r\n        // local instance is removed\r\n        registeredEvent = null;\r\n      }\r\n    }\r\n\r\n    // single postMessage call with enable list\r\n    if (eventToEnable.length > 0) {\r\n      SWAC.Communication._internal.call(_name, 'enableComponentEvent', [eventToEnable, evtLevel.level]);\r\n    }\r\n\r\n    return retVal;\r\n  },\r\n\r\n  /**\r\n  * Unsubscribe a function from event management\r\n  *\r\n  * @method unsubscribe\r\n  * @param {Function} callback function to remove\r\n  */\r\n  _unsubscribeEvent = function (callback) {\r\n    var evtLevel = null, i,\r\n      item, cbIndex,\r\n      hiddenEventToDisable = (arguments.length === 2) ? arguments[1] : [], // hidden parameter filled by parent to support mixed component's events propagation\r\n      registeredEvent,\r\n      eventToDisable = [];\r\n\r\n    if ((typeof callback !== 'function') && (hiddenEventToDisable.length === 0)) {\r\n      return;\r\n    }\r\n\r\n    if (typeof callback === 'function') {\r\n      // cycle all event records\r\n      for (item in _registeredEventList) {\r\n        // if the event has callback\r\n        if (_registeredEventList[item].callback.length > 0) {\r\n          // identify the specified callback\r\n          cbIndex = SWAC._internal.Utils.indexOf(_registeredEventList[item].callback, callback);\r\n          // if found remove it\r\n          if (cbIndex !== -1) {\r\n            // remove specified callback\r\n            _registeredEventList[item].callback.splice(cbIndex, 1);\r\n            if (_registeredEventList[item].callback.length === 0 && !_registeredEventList[item].insertFromBubble) {\r\n              // if no callback is present check if the event record is no more useful\r\n              if (!_registeredEventList[item].inherited) {\r\n                // get event level and its category\r\n                evtLevel = _getEventLevelAndCategory(_registeredEventList[item].name);\r\n                // event added to disable list\r\n                eventToDisable.push(_registeredEventList[item].name);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    else {\r\n      // nested event (created by parent) that needs to be disabled\r\n      evtLevel = {\r\n        level: '_nested'\r\n      };\r\n      for (i = 0; i < hiddenEventToDisable.length; i++) {\r\n        // get the event object from internal register\r\n        registeredEvent = _getRegisteredEvent(hiddenEventToDisable[i]);\r\n\r\n        if ((registeredEvent !== null) && !registeredEvent.insertFromBubble) {\r\n          eventToDisable.push(registeredEvent.name);\r\n        }\r\n      }\r\n    }\r\n\r\n    if (eventToDisable.length > 0) {\r\n      for (i = 0; i < eventToDisable.length; i++) {\r\n        // event is no longer necessary, it is removed from registered list\r\n        _removeFromRegisteredEventList(eventToDisable[i]);\r\n      }\r\n      // single postMessage call with disable list\r\n      SWAC.Communication._internal.call(_name, 'disableComponentEvent', [eventToDisable, evtLevel.level]);\r\n    }\r\n  },\r\n\r\n  /**\r\n  * Set bubble value for one or more events\r\n  *\r\n  * @method bubble\r\n  * @param {Boolean} enable bubble value\r\n  * @param {Object} filters one or more event names, if empty the bubble is set to all the supported events\r\n  */\r\n  _bubbleEvent = function (enable, filters) {\r\n    var arrayFilters, i,\r\n      registeredEvent = null,\r\n      evtLevel = null,\r\n      eventToEnable = [],\r\n      eventToDisable = [];\r\n\r\n    if ((typeof enable) === 'boolean') {\r\n      // array copy to always work with an array parameter\r\n      if ((filters === '') || (filters === null) || (filters === undefined)) {\r\n        arrayFilters = _supportedMouseEventList.split(' ');\r\n      }\r\n      else {\r\n        if (SWAC._internal.Utils.isArray(filters)) {\r\n          arrayFilters = filters;\r\n        }\r\n        else {\r\n          if ((typeof filters) === 'string') {\r\n            arrayFilters = [filters];\r\n          }\r\n        }\r\n      }\r\n\r\n      for (i = 0; i < arrayFilters.length; i++) {\r\n        // get the event object from internal register\r\n        registeredEvent = _getRegisteredEvent(arrayFilters[i]);\r\n\r\n        // get event level and its category\r\n        evtLevel = _getEventLevelAndCategory(arrayFilters[i]);\r\n\r\n        if (registeredEvent === null) {\r\n          // if the event is supported register the event at the appropriate level\r\n          if (evtLevel.level !== '') {\r\n            if (enable) {\r\n              // event added to list of registered events\r\n              _registeredEventList.push({ name: arrayFilters[i], bubble: enable, inherited: false, callback: [], insertFromBubble: true });\r\n              if (evtLevel.level === '_nested') {\r\n                // event added to enable list\r\n                eventToEnable.push(arrayFilters[i]);\r\n              }\r\n            }\r\n          }\r\n        }\r\n        else {\r\n          // event is already present, remove it if inserted from bubble\r\n          if (registeredEvent.insertFromBubble && (registeredEvent.callback.length === 0)) {\r\n            _removeFromRegisteredEventList(arrayFilters[i]);\r\n            eventToDisable.push(arrayFilters[i]);\r\n          }\r\n          else {\r\n            // event is already present, bubble value is changed\r\n            registeredEvent.bubble = enable;\r\n            registeredEvent.insertFromBubble = true;\r\n          }\r\n          // local instance is removed\r\n          registeredEvent = null;\r\n        }\r\n      }\r\n\r\n      // single postMessage call with enable list\r\n      if (eventToEnable.length > 0) {\r\n        SWAC.Communication._internal.call(_name, 'enableComponentEvent', [eventToEnable, evtLevel.level]);\r\n      }\r\n\r\n      // single postMessage call with disable list\r\n      if (eventToDisable.length > 0) {\r\n        SWAC.Communication._internal.call(_name, 'disableComponentEvent', [eventToDisable, evtLevel.level]);\r\n      }\r\n    }\r\n  };\r\n\r\n  //////////////\r\n  // PUBLIC   //\r\n  //////////////\r\n\r\n  // No return-block here to keep object type SWAC.Component (otherwise untyped <object>)\r\n\r\n  // API\r\n  this.beginShow = _beginShow;\r\n  this.beginRemove = _beginRemove;\r\n  this.getDomain = _getDomain;\r\n\r\n  this.beginPosition = _beginPosition;\r\n\r\n  this.beginCleanUpRequest = _beginCleanUpRequest;\r\n  this.getPosition = _getPosition;\r\n  this.type = _type;\r\n\r\n  /**\r\n  * Component's name.\r\n  *\r\n  * @method name\r\n  * @return {String} returns the name of the component\r\n  */\r\n  this.name = function () { return _name; };\r\n\r\n  /**\r\n   * Checks if the component has an user interface.\r\n   *\r\n   * @method hasUI\r\n   * @return {Boolean} returns if the component has UI.\r\n   */\r\n  this.hasUI = function () { return _settings.flavor === 'ui'; };\r\n\r\n  /**\r\n  * Component SWAC library version.\r\n  *\r\n  * @property swacVersion\r\n  * @return {string} returns the SWAC library version used in component\r\n  */\r\n  this.swacVersion = '1.0.0';\r\n\r\n  // EVENTS\r\n  this.onReady = _onReady.event;\r\n\r\n  this.onMouseEvents = {\r\n    subscribe: _subscribeEvent,\r\n    unsubscribe: _unsubscribeEvent,\r\n    bubble: _bubbleEvent\r\n  };\r\n\r\n  // INTERNAL\r\n  this._internal = {\r\n    beginExpose: _beginExpose,\r\n    close: _close,\r\n    fire: _fire,\r\n    dpcChanged: _dpcChanged,\r\n    beginHandshake: _beginHandshake,\r\n    tlsMessage: _tlsMessage,\r\n    beginRequestInterface: _beginRequestInterface,\r\n    beginRequestService: _beginRequestService,\r\n    callService: _callService,\r\n    setCurrentUrl: _setCurrentUrl,\r\n    getCurrentUrl: _getCurrentUrl,\r\n    iframe: _iframe,\r\n    lastIsDirtyValue: _lastIsDirtyValue,\r\n    manageEvent: _manageEvent,\r\n    getRegisteredEvent: _getRegisteredEvent,\r\n    removeComponentServiceAndBubble: _removeComponentServiceAndBubble\r\n  };\r\n\r\n  // PROXY\r\n  this.proxy = _proxy;\r\n\r\n  /**\r\n  * Provides methods to access all component interfaces\r\n  *\r\n  * @property interfaces\r\n  * @return {object} returns the SWAC.Interfaces object\r\n  */\r\n  this.interfaces = null;  // will be set during beginExpose\r\n};\r\n\r\n\r\n///////////////////////////////////////////\r\n// lib/container/container.js\r\n\r\n\r\n/**\r\n * Single instance object that permits to create and destroy SWAC.Component\r\n *\r\n * @class SWAC.Container\r\n * @constructor\r\n * \r\n */\r\nSWAC.Container = (function () {\r\n\r\n  //////////////\r\n  // PRIVATE  //\r\n  //////////////\r\n\r\n  var\r\n      _language = window.navigator.language,\r\n      _componentRemovalInProgress = false,\r\n\r\n      _observer = null,\r\n      _beginCloseCalls = {},\r\n\r\n      // Holds successfully created components only.\r\n      _publicRegistry = {},\r\n\r\n      // Used during hand-shake only.\r\n      _creationRegistry = {},\r\n\r\n      _status = (new SWAC.DPC.Node(null, 'Owner', SWAC.DPC.Permissions.Read, 'status', false)),\r\n\r\n      _onRemoved = new SWAC.Eventing.Publisher('onRemoved');\r\n\r\n      _status.set('Owner', 'isDirty', false, 'boolean');\r\n\r\n    /**\r\n  * Method for removing a component.\r\n  *\r\n  * @protected\r\n  * @method remove\r\n  * @param {String} name name of the component.\r\n  * @param {object} iframe iframe that contains the component.\r\n  * @param {object} reason reason for component removal.\r\n  */\r\n     var _removeComponent = function (name, iframe, reason) {\r\n       var localCmpName = SWAC._internal.Utils.getFullName();\r\n\r\n       if (_publicRegistry[name]) {\r\n         if (iframe) {\r\n           iframe.src = 'about:blank';\r\n           if (iframe.parentNode) {\r\n             _componentRemovalInProgress = true;\r\n             iframe.parentNode.removeChild(iframe);\r\n           }\r\n           iframe = null;\r\n         }\r\n         reason = reason ? reason : '';\r\n         if (localCmpName) {\r\n           localCmpName.push(name);\r\n           _publicRegistry[name]._internal.removeComponentServiceAndBubble.apply({ o: localCmpName });\r\n         }\r\n         else {\r\n           SWAC.Services._internal.removeServices('[\"<root>\",\"' + name + '\"]'); // remove all component-bound service instances.\r\n         }\r\n         delete _publicRegistry[name];\r\n         _onRemoved.notify({ name: name, reason: reason });\r\n       }\r\n     };\r\n\r\n  /**\r\n * Starting from parameters this method creates the iframe containing the component\r\n *\r\n * @private\r\n * @method _beginCreateIFrame\r\n * @param {object} arg arguments for creating the iframe\r\n * @return {object} an object defer.promise.\r\n */\r\n  var _beginCreateIFrame = function (arg) {\r\n    var defer = new SWAC.Defer(),\r\n      parent = arg.parent ? arg.parent : document.body,\r\n      source = arg.source,\r\n      settings = arg.settings,\r\n      name = arg.name,\r\n      callBackOnLoadIframe = null,\r\n      onLoadErrorCallback = null,\r\n      iframe;\r\n\r\n    // Add the iframe\r\n\r\n    iframe = document.createElement('iframe');\r\n    iframe.src = source;\r\n    iframe.frameBorder = 0;\r\n    iframe.name = name;\r\n\r\n    iframe.style.position = 'absolute';\r\n    iframe.SWACLoaded = false;\r\n\r\n    if ((settings.flavor !== 'ui') && (!settings.left || !settings.top)) {\r\n      settings.left = '0px';\r\n      settings.top = '0px';\r\n    }\r\n    else {\r\n      if ((!window.addEventListener) && (!settings.left || !settings.top)) { //IE8\r\n        settings.left = '0px';\r\n        settings.top = '0px';\r\n      }\r\n      else {\r\n        iframe.style.left = settings.left;\r\n        iframe.style.top = settings.top;\r\n      }\r\n    }\r\n\r\n    iframe.style.width = '0px'; // start with 0, since iframes do not support visibility:hidden\r\n    iframe.style.height = '0px'; // start with 0, since iframes do not support visibility:hidden\r\n    iframe.style.display = 'none';\r\n\r\n    _creationRegistry[arg.name].iframe = iframe;\r\n\r\n    callBackOnLoadIframe = function (e) {\r\n      var target = e.target ? e.target : e.srcElement;\r\n\r\n      if (!target) {\r\n        defer.reject(new SWAC.Reason(13005));\r\n        return;\r\n      }\r\n      if (_creationRegistry[target.name] || _publicRegistry[target.name]) {\r\n        if (target.SWACLoaded === false) {\r\n          // Component creation\r\n          target.SWACLoaded = true;\r\n          defer.fulfill(target);\r\n        }\r\n        else {\r\n          if (_publicRegistry[target.name]) {\r\n            target.setAttribute('redirect-detected', 'true');\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    if (iframe.addEventListener) {\r\n      iframe.addEventListener('load', callBackOnLoadIframe);\r\n    }\r\n    else {\r\n      iframe.attachEvent('onload', callBackOnLoadIframe);\r\n    }\r\n\r\n    onLoadErrorCallback = function () {\r\n      iframe.src = 'about:blank';\r\n      try {\r\n        _componentRemovalInProgress = true;\r\n        parent.removeChild(iframe);\r\n        iframe = null;\r\n      }\r\n      catch (e) {\r\n      }\r\n      defer.reject(new SWAC.Reason(11014));\r\n    };\r\n\r\n    if (iframe.addEventListener) {\r\n      iframe.addEventListener('error', onLoadErrorCallback);\r\n    }\r\n    else {\r\n      iframe.attachEvent('onerror', onLoadErrorCallback);\r\n    }\r\n\r\n    parent.appendChild(iframe);\r\n    iframe = null;\r\n\r\n    return defer.promise;\r\n  },\r\n\r\n    _onFailure = new SWAC.Eventing.Publisher('onFailure'),\r\n\r\n    /**\r\n    * Fire OnFailure event.\r\n    *\r\n    * @private\r\n    * @method fireOnFailure\r\n    * @param {String} name name of the component.\r\n    * @param {String} phase phase where the failure occours.\r\n    * @param {String} reason failure reason.\r\n    * @param {Boolean} async asyncronous event fire.\r\n    */\r\n  _fireOnFailure = function (name, phase, reason, async) {\r\n    _onFailure.notify({ name: name, details: { phase: phase, reason: reason } }, async);\r\n  },\r\n\r\n   /**\r\n  * Check if an iframe is related to a component.\r\n  *\r\n  * @private\r\n  * @method checkIframe\r\n  * @param {String} name name of the component.\r\n  * @return {object} iframe iframe object.\r\n  */\r\n  _checkIframe = function (name) {\r\n    var iFrameList = document.querySelectorAll('iframe[name=\"' + name + '\"]'),\r\n      currentIframe = null,\r\n      relatedComponent = null;\r\n\r\n    if (iFrameList.length > 0) {\r\n      relatedComponent = SWAC.Container.get({ name: name });\r\n      if (relatedComponent instanceof SWAC.Component) {\r\n        for (currentIframe in iFrameList) {\r\n          if (iFrameList.hasOwnProperty(currentIframe)) {\r\n            if (relatedComponent._internal.iframe === iFrameList[currentIframe]) {\r\n              return true;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return false;\r\n  },\r\n\r\n  /**\r\n   * Creates a SWAC component or a series of SWAC components\r\n   *\r\n   * @method beginCreate\r\n   * @param {object} args one or more components to create\r\n   * @return {object} an object defer.promise.\r\n   */\r\n  _beginCreate = function (args) {\r\n    // Check what kind of argument we got:\r\n    //  - Array, that is a bunch of components. (Even nested arrays are fine.)\r\n    //  - object, that is a single component\r\n    //  - anything else (int, string) is not valid\r\n    var defer = new SWAC.Defer(),\r\n      ok = 0,\r\n      failed = 0,\r\n      all = 0,\r\n      check = function () {\r\n        if (ok === all) {\r\n          defer.fulfill();\r\n        } else if ((ok + failed) === all) {\r\n          defer.reject(new SWAC.Reason(13006));\r\n        }\r\n      },\r\n      onsuccess = function () {\r\n        ok++;\r\n        check();\r\n      },\r\n      onfailure = function () {\r\n        failed++;\r\n        check();\r\n      },\r\n      i = 0,\r\n      checkSource = function () {\r\n        var _iframe = document.createElement('iframe');\r\n        _iframe.src = args.source;\r\n        if (_iframe.src === window.location.href) {\r\n          _iframe = null;\r\n          return false;\r\n        }\r\n        _iframe = null;\r\n        return true;\r\n      };\r\n\r\n    // In case of array, start simple recursion and chain all promises.\r\n    if (SWAC._internal.Utils.isArray(args)) {\r\n      all = args.length;\r\n\r\n      for (i = 0; i < all; i++) {\r\n        SWAC.Container.beginCreate(args[i]).then(onsuccess, onfailure);\r\n      }\r\n\r\n      return defer.promise;\r\n    }\r\n\r\n    // In case of object, start ducktyping.\r\n    if ((args !== null) && (typeof args === 'object')) {\r\n\r\n      if (_creationRegistry[args.name] || _publicRegistry[args.name]) {\r\n        if (!SWAC.Container._internal.checkIframe(args.name)) {\r\n          _fireOnFailure(args.name, 'integrityCheck', 'Component integrity is compromised', false);\r\n          _removeComponent(args.name, null, new SWAC.Reason(15005));\r\n        }\r\n        else {\r\n          _fireOnFailure(args.name, 'creation', 'Component already present in registry', true);\r\n          defer.reject(new SWAC.Reason(13003));\r\n          return defer.promise;\r\n        }\r\n      }\r\n\r\n      if (!args.source || !args.name) {\r\n        defer.reject(new SWAC.Reason(13008));\r\n        return defer.promise;\r\n      }\r\n\r\n      if (!checkSource()) {\r\n        defer.reject(new SWAC.Reason(13008));\r\n        return defer.promise;\r\n      }\r\n\r\n      if (!args.settings) {\r\n        args.settings = {};\r\n      }\r\n\r\n      if (!args.settings.flavor) {\r\n        args.settings.flavor = 'ui';\r\n      }\r\n\r\n      _creationRegistry[args.name] = {\r\n        name: args.name,\r\n        type: args.type,\r\n        state: 'pending',\r\n        settings: args.settings,\r\n        promise: defer,\r\n        lastUrl: ''\r\n      };\r\n\r\n      _beginCreateIFrame(args).then(\r\n          // onSuccess: iframe got created, there should arrive a boot-message before time-out.\r\n          function (iframe) {\r\n            var timeoutHandler = function () {\r\n              if (_creationRegistry[args.name] && (_creationRegistry[args.name].state === 'pending')) {\r\n                // Remove iframe\r\n                iframe.src = 'about:blank';\r\n                if (iframe.parentNode) {\r\n                  _componentRemovalInProgress = true;\r\n                  iframe.parentNode.removeChild(iframe);\r\n                }\r\n                iframe = null;\r\n                _fireOnFailure(args.name, 'creation', 'Timeout in beginCreateIframe', true);\r\n\r\n                _creationRegistry[args.name].promise.reject(new SWAC.Reason(13007));\r\n                delete _creationRegistry[args.name];\r\n              }\r\n            };\r\n\r\n            if (_creationRegistry[args.name]) {\r\n              if (SWAC.Config.TimeOuts.Enabled) {\r\n                _creationRegistry[args.name].timeout = window.setTimeout(timeoutHandler, SWAC.Config.TimeOuts.Create);\r\n              }\r\n            }\r\n          },\r\n          function (reason) {\r\n            defer.reject(reason);\r\n          }\r\n      );\r\n\r\n      return defer.promise;\r\n    }\r\n\r\n    defer.reject(new SWAC.Reason(13008));\r\n    return defer.promise;\r\n  },\r\n\r\n   /**\r\n   * Identifies a component by its iframe.\r\n   *\r\n   * @protected\r\n   * @method identify\r\n   * @param {object} iframe iframe that contains the component.\r\n   * @param {Boolean} published parameter that indicate if the component is published or not.\r\n   */\r\n  _identify = function (iframe, published) {\r\n    var registry = published ? _publicRegistry : _creationRegistry,\r\n      key = null,\r\n      component = null;\r\n\r\n    for (key in registry) {\r\n      if (registry.hasOwnProperty(key)) {\r\n        component = registry[key];\r\n        if (registry === _creationRegistry) {\r\n          if ((component.iframe.contentWindow === iframe) || (component.iframe === iframe)) {\r\n            return component;\r\n          }\r\n        }\r\n        else {\r\n          if ((component._internal.iframe.contentWindow === iframe) || (component._internal.iframe === iframe)) {\r\n            return component;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // If started searching within currently created components, also search within those already published\r\n    if (!published) {\r\n      return _identify(iframe, true);\r\n    }\r\n  },\r\n\r\n    _onCreated = new SWAC.Eventing.Publisher('onCreated'),\r\n    _onReady = new SWAC.Eventing.Publisher('onReady'),\r\n\r\n   /**\r\n   * Component could successfully be loaded.\r\n   *\r\n   * @protected\r\n   * @method accept\r\n   * @param {object} iframe iframe that contains the component.\r\n   */\r\n  _acceptComponent = function (iframe) {\r\n    var component = _identify(iframe);\r\n\r\n    if (component && component.promise) {\r\n      if (SWAC.Config.TimeOuts.Enabled) {\r\n        window.clearTimeout(component.timeout);\r\n      }\r\n      component.state = 'hidden';\r\n\r\n      _publicRegistry[component.name] = new SWAC.Component(component.name, component.iframe, component.type, component.settings, component.lastUrl, _onReady);\r\n      _publicRegistry[component.name]._internal.lastIsDirtyValue = false;\r\n\r\n      if (component.attributes) {\r\n        _publicRegistry[component.name].attributes = component.attributes;\r\n      }\r\n\r\n      if (component.authentication) { // component requested handshake\r\n        _publicRegistry[component.name]._internal.beginHandshake(SWAC.Config.Container.Authentication.TlsHandler, SWAC.Config.TimeOuts.Authentication.Handshake).then(\r\n            function (value) {\r\n            },\r\n            function (reason) {\r\n              var comp = _publicRegistry[component.name];\r\n              if (comp) {\r\n                comp.beginRemove({ reason: 'auth-failed' });\r\n              }\r\n            });\r\n      }\r\n      delete _creationRegistry[component.name];\r\n\r\n      component.promise.fulfill();\r\n\r\n      // Creation-phase in component life-cycle successfull\r\n      _onCreated.notify({ name: component.name }, true);\r\n\r\n      return true;\r\n    }\r\n    else {\r\n      return false;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Sets the component state in bag\r\n   *\r\n   * @private\r\n   * @method _setComponentInternalStatusInBag\r\n   */\r\n    _setComponentInternalStatusInBag = function (name, privateStatus, bag, component, oldValue) {\r\n      var failCallback,\r\n      closeFlag = true,\r\n      cleanCount = 0,\r\n      i = 0,\r\n      isDirty;\r\n\r\n      failCallback = function () {\r\n        return function (reason) {\r\n          if (reason.reasonCode !== 11005 || !bag.closeOnCleanUpTimeOut) {\r\n            bag.beginCloseDeferer.reject(reason);\r\n            if (SWAC.Config.TimeOuts.Enabled) {\r\n              window.clearTimeout(bag.beginCloseTimer);\r\n            }\r\n            delete _beginCloseCalls[bag.guid];\r\n          }\r\n        };\r\n      };\r\n\r\n      if ((component._internal.lastIsDirtyValue === true) && (oldValue === false) && (bag.closingBroadcast === true)) {\r\n        component.beginCleanUpRequest().then(null, failCallback());\r\n      }\r\n\r\n      if (component._internal.lastIsDirtyValue === false) {\r\n        for (i = 0; i < bag.closingComponents.length; i++) {\r\n          if (bag.closingComponents[i].component !== null) {\r\n            isDirty = bag.closingComponents[i].component._internal.lastIsDirtyValue;\r\n            if (isDirty) {\r\n              if (bag.closingBroadcast) {\r\n                closeFlag = false;\r\n              }\r\n            }\r\n            else {\r\n              cleanCount++;\r\n            }\r\n            if (cleanCount === bag.closingComponents.length) {\r\n              bag.loopInterrupted = false;\r\n            }\r\n          }\r\n        }\r\n\r\n        if ((bag.closingBroadcast && closeFlag) || (!bag.closingBroadcast && !bag.loopInterrupted)) {\r\n          for (i = 0; i < bag.closingComponents.length; i++) {\r\n            if (bag.closingComponents[i].component !== null) {\r\n              bag.closingComponents[i].component.beginRemove();\r\n            }\r\n          }\r\n          if (SWAC.Config.TimeOuts.Enabled) {\r\n            window.clearTimeout(bag.beginCloseTimer);\r\n         }\r\n        }\r\n      }\r\n    },\r\n\r\n   /**\r\n   * Returns component instances\r\n   *\r\n   * @method get\r\n   * @param {object} filter by type returns an array, by name returns an instance\r\n   * @return {object} a SWAC.Component or an array of SWAC.Component\r\n   */\r\n  _get = function (filter) {\r\n    var found = [],\r\n      i = 0,\r\n      candidate,\r\n      candidateName,\r\n      arr = [],\r\n      entry,\r\n      sameAttr;\r\n\r\n    if (filter) {\r\n      if (filter.name) {\r\n        if (typeof (filter.name) === 'string') {\r\n          if (!filter.type && !filter.dirty) {\r\n            return _publicRegistry[filter.name];\r\n          }\r\n          else {\r\n            found.push(_publicRegistry[filter.name]);\r\n          }\r\n        }\r\n        else if (Object.prototype.toString.call(filter.name) === '[object Array]') {\r\n          for (candidateName in filter.name) {\r\n            if (filter.name.hasOwnProperty(candidateName)) {\r\n              for (candidate in _publicRegistry) {\r\n                if (_publicRegistry.hasOwnProperty(candidate) && _publicRegistry[candidate].name() === filter.name[candidateName]) {\r\n                  found.push(_publicRegistry[candidate]);\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n      if (filter.type) {\r\n        if (!filter.name) {\r\n          for (candidate in _publicRegistry) {\r\n            if (_publicRegistry.hasOwnProperty(candidate) && _publicRegistry[candidate].type() === filter.type) {\r\n              found.push(_publicRegistry[candidate]);\r\n            }\r\n          }\r\n        }\r\n        else {\r\n          for (i = found.length - 1; i >= 0; i--) {\r\n            if (found[i] && found[i].type() !== filter.type) {\r\n              found.splice(i, 1);\r\n            }\r\n          }\r\n        }\r\n      }\r\n      if (filter.dirty) {\r\n        if ((!filter.name) && (!filter.type)) {\r\n          for (candidate in _publicRegistry) {\r\n            if (_publicRegistry.hasOwnProperty(candidate) && (_publicRegistry[candidate]._internal.lastIsDirtyValue === filter.dirty)) {\r\n              found.push(_publicRegistry[candidate]);\r\n            }\r\n          }\r\n        }\r\n        else {\r\n          for (i = found.length - 1; i >= 0; i--) {\r\n            if (found[i] && (found[i]._internal.lastIsDirtyValue !== filter.dirty)) {\r\n              found.splice(i, 1);\r\n            }\r\n          }\r\n        }\r\n      }\r\n      if (filter.attributes) {\r\n        for (candidate in _publicRegistry) {\r\n          if (_publicRegistry.hasOwnProperty(candidate) && _publicRegistry[candidate].attributes) {\r\n            sameAttr = true;\r\n            for (entry in filter.attributes) {\r\n              if (filter.attributes.hasOwnProperty(entry)) {\r\n                if (!_publicRegistry[candidate].attributes.hasOwnProperty(entry) || _publicRegistry[candidate].attributes[entry] !== filter.attributes[entry]) {\r\n                  sameAttr = false;\r\n                  break;\r\n                }\r\n              }\r\n            }\r\n            if (sameAttr) {\r\n              found.push(_publicRegistry[candidate]);\r\n            }\r\n          }\r\n        }\r\n      }\r\n      return found;\r\n    }\r\n    else {\r\n      for (entry in _publicRegistry) {\r\n        if (_publicRegistry.hasOwnProperty(entry)) {\r\n          arr.push(_publicRegistry[entry]);\r\n        }\r\n      }\r\n      return arr;\r\n    }\r\n  },\r\n\r\n    /**\r\n  * Sets true if at least one component is in dirty status\r\n  *\r\n  * @private\r\n  * @method _updateContainerDirtyState\r\n  */\r\n  _updateContainerDirtyState = function () {\r\n    var res = false,\r\n      components = _get({ dirty: true });\r\n\r\n    if (components.length > 0) {\r\n      res = true;\r\n    }\r\n\r\n    _status.set('Owner', 'isDirty', res, 'boolean');\r\n  },\r\n\r\n    /**\r\n   * Sets the component state (clean or dirty)\r\n   *\r\n   * @protected\r\n   * @method setComponentInternalStatus\r\n   * @param {string} name name of the component.\r\n   * @param {boolean} privateStatus component status.\r\n   */\r\n   _setComponentInternalStatus = function (name, privateStatus) {\r\n     var component = _get({ name: name }),\r\n        oldValue, bagIt, bag;\r\n\r\n     if (component) {\r\n       oldValue = component._internal.lastIsDirtyValue;\r\n       component._internal.lastIsDirtyValue = privateStatus;\r\n\r\n       if (oldValue === privateStatus) {\r\n         return;\r\n       }\r\n       _updateContainerDirtyState();\r\n\r\n       for (bagIt in _beginCloseCalls) {\r\n         if (_beginCloseCalls.hasOwnProperty(bagIt)) {\r\n           bag = _beginCloseCalls[bagIt];\r\n           if (SWAC._internal.Utils.indexOf(bag.closingComponentsNames, name, 0) > -1) {\r\n             _setComponentInternalStatusInBag(name, privateStatus, bag, component, oldValue);\r\n           }\r\n         }\r\n       }\r\n     }\r\n   },\r\n\r\n  /**\r\n   * Gets the component state (clean or dirty)\r\n   *\r\n   * @protected\r\n   * @method getComponentInternalStatus\r\n   * @param {string} name name of the component.\r\n   * @return {boolean}  state of the component.\r\n   */\r\n  _getComponentInternalStatus = function (name) {\r\n    var component = _get({ name: name });\r\n    if (component) {\r\n      return component._internal.lastIsDirtyValue;\r\n    }\r\n    throw new SWAC.Exception(1001);\r\n  },\r\n\r\n   /**\r\n   * Discard and remove the component after a creation failure.\r\n   *\r\n   * @protected\r\n   * @method discard\r\n   * @param {object} iframe iframe that contains the component.\r\n   */\r\n  _discardComponent = function (iframe) {\r\n    var component = _identify(iframe);\r\n\r\n    if (component) {\r\n      if (SWAC.Config.TimeOuts.Enabled) {\r\n        window.clearTimeout(component.timeout);\r\n      }\r\n      component.state = 'removing';\r\n      component.promise.reject(new SWAC.Reason(13010));\r\n\r\n      if (component.iframe) {\r\n        component.iframe.src = 'about:blank';\r\n        if (component.iframe.parentNode) {\r\n          _componentRemovalInProgress = true;\r\n          component.iframe.parentNode.removeChild(component.iframe);\r\n        }\r\n        component.iframe = null;\r\n      }\r\n\r\n      // Creation-phase in component life-cycle failed\r\n      _fireOnFailure(component.name, 'creation', 'Component discarded by communication protocol', false);\r\n\r\n      delete _creationRegistry[component.name];\r\n    }\r\n  },\r\n\r\n    /**\r\n      * Method for searching a component inside bag.closingComponents array.\r\n      *\r\n      * @private\r\n      * @method _findAndRemoveComponentfromList\r\n      * @param {String} componentName name of the component.\r\n      * @return {Boolean} true or false if the component is found.\r\n      */\r\n    _findAndRemoveComponentfromList = function (componentName, bag) {\r\n      var i;\r\n      for (i = 0; i < bag.closingComponents.length; i++) {\r\n        if (bag.closingComponents[i].name === componentName) {\r\n          bag.closingComponents.splice(i, 1);\r\n          return true;\r\n        }\r\n      }\r\n      return false;\r\n    },\r\n\r\n    /**\r\n   * Checks for removed component\r\n   *\r\n   * @private\r\n   * @method _compDisappears\r\n   * @param {object} event data of the disappeared component\r\n   */\r\n  _compDisappears = function (event) {\r\n    var bagIt, bag;\r\n    for (bagIt in _beginCloseCalls) {\r\n      if (_beginCloseCalls.hasOwnProperty(bagIt)) {\r\n        bag = _beginCloseCalls[bagIt];\r\n        if (SWAC._internal.Utils.indexOf(bag.closingComponentsNames, event.data.name, 0) > -1) {\r\n          if (_findAndRemoveComponentfromList(event.data.name, bag)) {\r\n            if (bag.closingComponents.length === 0) {\r\n              bag.beginCloseDeferer.fulfill();\r\n              delete _beginCloseCalls[bag.guid];\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n   /**\r\n   * Closes and destroys a SWAC component or a series of SWAC components.\r\n   *\r\n   * @method beginClose\r\n   * @param {String/Arrays} nameComponents String array, or single string, of component name to close. Null otherwirse send begin close message to all dirty components\r\n   * @param {Boolean} broadcast parameter for calling the method in broadcast or sequential mode.\r\n   * @param {Number} timeout millisecond timeout required for the closing operation.\r\n   * @param {Boolean} behavior in case of timeout. If true all components will be closed.\r\n   * @return {object} an object defer.promise.\r\n   */\r\n  _beginClose = function (nameComponents, broadcast, timeout, closeOnCleanUpTimeOut) {\r\n    var components = null,\r\n      tmpcomponent = null,\r\n      closeFlag = true,\r\n      removeAllComponents = null,\r\n      failCallback = null,\r\n       succClb = null,\r\n      i = 0,\r\n      isDirty,\r\n      guid = SWAC.Guid.generate(),\r\n      bag = {\r\n        guid: guid\r\n      };\r\n\r\n    _beginCloseCalls[guid] = bag;\r\n    bag.beginCloseDeferer = new SWAC.Defer();\r\n    timeout = timeout || SWAC.Config.TimeOuts.Close;\r\n    broadcast = ((broadcast === null) || (broadcast === undefined)) ? true : broadcast;\r\n\r\n    if (closeOnCleanUpTimeOut !== null && closeOnCleanUpTimeOut !== undefined && closeOnCleanUpTimeOut !== '') {\r\n      closeOnCleanUpTimeOut = closeOnCleanUpTimeOut;\r\n    }\r\n    else if (SWAC.Config.Container.Behaviors.CloseOnCleanUpTimeOut !== null && SWAC.Config.Container.Behaviors.CloseOnCleanUpTimeOut !== undefined && SWAC.Config.Container.Behaviors.CloseOnCleanUpTimeOut !== '') {\r\n      closeOnCleanUpTimeOut = SWAC.Config.Container.Behaviors.CloseOnCleanUpTimeOut;\r\n    }\r\n    else if (SWAC.Config.Container.Behaviors.CloseTimeoutConfirm !== null && SWAC.Config.Container.Behaviors.CloseTimeoutConfirm !== undefined && SWAC.Config.Container.Behaviors.CloseTimeoutConfirm !== '') {\r\n      closeOnCleanUpTimeOut = SWAC.Config.Container.Behaviors.CloseTimeoutConfirm;\r\n    }\r\n    else {\r\n      closeOnCleanUpTimeOut = true;\r\n    }\r\n\r\n    bag.closeOnCleanUpTimeOut = closeOnCleanUpTimeOut;\r\n    bag.closingBroadcast = broadcast;\r\n    bag.loopInterrupted = false;\r\n\r\n    if ((nameComponents === null) || (nameComponents === undefined)) {\r\n      components = _get();\r\n    }\r\n    else {\r\n      if (SWAC._internal.Utils.isArray(nameComponents)) {\r\n        components = [];\r\n        for (i = 0; i < nameComponents.length; i++) {\r\n          tmpcomponent = _get({ name: nameComponents[i] });\r\n          if (tmpcomponent) {\r\n            components.push(tmpcomponent);\r\n          }\r\n        }\r\n      }\r\n      else {\r\n        components = _get({ name: nameComponents });\r\n        if (components) {\r\n          components = [components];\r\n        }\r\n      }\r\n\r\n      if (components === null || components === undefined || components.length === 0) {\r\n        bag.beginCloseDeferer.reject(new SWAC.Reason(13015));\r\n        delete _beginCloseCalls[guid];\r\n        return bag.beginCloseDeferer.promise;\r\n      }\r\n    }\r\n\r\n    bag.closingComponents = [];  // Array of object {component: SWAC.Component, name: string}\r\n    bag.closingComponentsNames = [];  // Array of component's name to close\r\n    for (i = 0; i < components.length; i++) {\r\n      if (components[i] !== null) {\r\n        bag.closingComponentsNames.push(components[i].name());\r\n        bag.closingComponents.push({ component: components[i], name: components[i].name() });\r\n      }\r\n    }\r\n\r\n    removeAllComponents = function () {\r\n      for (i = 0; i < components.length; i++) {\r\n        if (components[i] !== null) {\r\n          components[i].beginRemove();\r\n        }\r\n      }\r\n    };\r\n\r\n    if (SWAC.Config.TimeOuts.Enabled) {\r\n      bag.beginCloseTimer = window.setTimeout(function () {\r\n        if (closeOnCleanUpTimeOut) {\r\n          removeAllComponents();\r\n        }\r\n        else {\r\n          bag.beginCloseDeferer.reject(new SWAC.Reason(13011));\r\n          delete _beginCloseCalls[guid];\r\n        }\r\n      }, timeout);\r\n    }\r\n    failCallback = function (reason) {\r\n      if (reason.reasonCode !== 11005 || !closeOnCleanUpTimeOut) {\r\n        bag.beginCloseDeferer.reject(reason);\r\n        if (SWAC.Config.TimeOuts.Enabled) {\r\n          window.clearTimeout(bag.beginCloseTimer);\r\n        }\r\n        delete _beginCloseCalls[guid];\r\n      }\r\n      else {\r\n        if (broadcast) {\r\n          return;\r\n        }\r\n        i++;\r\n        if (components[i]) {\r\n          isDirty = components[i]._internal.lastIsDirtyValue;\r\n          if (isDirty) {\r\n            components[i].beginCleanUpRequest().then(succClb, failCallback);\r\n          }\r\n        }\r\n        else {\r\n          bag.loopInterrupted = false;\r\n        }\r\n      }\r\n    };\r\n\r\n    succClb = function (value) {\r\n      if (broadcast) {\r\n        return;\r\n      }\r\n      i++;\r\n      if (components[i]) {\r\n        isDirty = components[i]._internal.lastIsDirtyValue;\r\n        if (isDirty) {\r\n          components[i].beginCleanUpRequest().then(succClb, failCallback);\r\n        }\r\n      }\r\n      else {\r\n        bag.loopInterrupted = false;\r\n      }\r\n    };\r\n\r\n    for (i = 0; i < components.length; i++) {\r\n      if (components[i]) {\r\n        isDirty = components[i]._internal.lastIsDirtyValue;\r\n        if (isDirty) {\r\n          if (broadcast) {\r\n            closeFlag = false;\r\n          }\r\n          components[i].beginCleanUpRequest().then(succClb, failCallback);\r\n          if (!broadcast) {\r\n            bag.loopInterrupted = true;\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if ((broadcast && closeFlag) || (!broadcast && !bag.loopInterrupted)) {\r\n      removeAllComponents();\r\n      if (SWAC.Config.TimeOuts.Enabled) {\r\n        window.clearTimeout(bag.beginCloseTimer);\r\n      }\r\n    }\r\n    return bag.beginCloseDeferer.promise;\r\n  },\r\n\r\n  /**\r\n   * Returns the container's current language.\r\n   *\r\n   * @private\r\n   * @method _findAndRemoveComponentfromList\r\n   * @param {String} componentName name of the component.\r\n   * @return {Boolean} true or false if the component is found.\r\n   */\r\n  _getLanguage = function () {\r\n    return _language;\r\n  },\r\n\r\n  /**\r\n  * Sets the current language of the container.\r\n  *\r\n  * @private\r\n  * @method setLanguage\r\n  * @param {string} tag language tag according to [BCP47]\r\n  */\r\n  _setLanguage = function (tag) {\r\n    _language = tag;\r\n    var components = _get();\r\n    if (components && components.length > 0) {\r\n      components.forEach(function (cmp) {\r\n        if (cmp && cmp.status && cmp.status.open('language')) {\r\n          SWAC.Communication._internal.call(cmp.name(), 'setPrivateDPC', ['language', tag]);\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n  _onRemoved.event.subscribe(_compDisappears);\r\n\r\n  _onCreated.event.subscribe(function () {\r\n    if (window['MutationObserver'] && _observer === null) {\r\n      _observer = new MutationObserver(function (mutation) {\r\n        if ((mutation[0].removedNodes.length > 0) && (mutation[0].removedNodes[0].tagName === 'IFRAME')) {\r\n          if (typeof mutation[0].removedNodes[0].SWACLoaded === 'boolean') {\r\n            if (_componentRemovalInProgress) {\r\n              _componentRemovalInProgress = false;\r\n            }\r\n            else {\r\n              _fireOnFailure(mutation[0].removedNodes[0].name, 'integrityCheck', 'Component integrity is compromised', false);\r\n              _removeComponent(mutation[0].removedNodes[0].name, null, new SWAC.Reason(15005));\r\n            }\r\n          }\r\n        }\r\n      });\r\n      _observer.observe(document.body, { childList: true, subtree: true });\r\n    }\r\n  });\r\n\r\n  _onRemoved.event.subscribe(function () {\r\n    var components = _get();\r\n    if (components && components.length === 0) {\r\n      if (window['MutationObserver'] && _observer !== null) {\r\n        _observer.disconnect();\r\n        _observer = null;\r\n      }\r\n    }\r\n  });\r\n\r\n  //////////////\r\n  // PUBLIC   //\r\n  //////////////\r\n\r\n  return {\r\n\r\n    // API\r\n    beginCreate: _beginCreate,\r\n\r\n    beginClose: _beginClose,\r\n\r\n    get: _get, // There is no dedicated remove-function on the container. Get the component and call remove explicitely.\r\n\r\n    getLanguage: _getLanguage,\r\n\r\n    setLanguage: _setLanguage,\r\n\r\n    /**\r\n    * Provides access to internal container status dpc structure.\r\n    *\r\n    * @property status\r\n    * @return {object} returns the status dpc\r\n    */\r\n    status: _status.access(),\r\n\r\n    // EVENTS\r\n\r\n    /**\r\n     * Fired when a new component is created in the container\r\n     *\r\n     * @event onCreated\r\n     */\r\n    onCreated: _onCreated.event,\r\n\r\n    /**\r\n     * Fired when a new component exposed its methods/events and is fully functional\r\n     *\r\n     * @event onReady\r\n     */\r\n    onReady: _onReady.event,\r\n\r\n    /**\r\n     * Fired when a component is removed from container\r\n     *\r\n     * @event onRemoved\r\n     */\r\n    onRemoved: _onRemoved.event,\r\n\r\n    /**\r\n     * Fired when a component has thrown an error (Can also be that component could not be created)\r\n     *\r\n     * @event onFailure\r\n     */\r\n    onFailure: _onFailure.event,\r\n\r\n    // INTERNAL, DO NOT USE\r\n    _internal: {\r\n      accept: _acceptComponent, // Called when component-handshake was successfull\r\n      discard: _discardComponent, // Called when component-handshake failed (e.g. container library could not be loaded)\r\n      remove: _removeComponent, // Called when component has to be returned from collection of available components.\r\n      identify: _identify,\r\n      setComponentInternalStatus: _setComponentInternalStatus,\r\n      getComponentInternalStatus: _getComponentInternalStatus,\r\n      fireOnFailure: _fireOnFailure,\r\n      checkIframe: _checkIframe\r\n    }\r\n  };\r\n}());\r\n\r\n/**\r\n* Container version.\r\n*\r\n* @property version\r\n* @return {string} returns the container version\r\n*/\r\nSWAC.Container.version = '1.5.1';\r\n\r\n\r\n///////////////////////////////////////////\r\n// lib/container/interfaces.js\r\n\r\n\r\n/**\r\n *  Interfaces is an object on the Component object for each contributing application. (in-container)\r\n *\r\n * @class SWAC.Interfaces\r\n * @constructor\r\n * @param {object} keys List of interface.\r\n * @param {object} owner owner of the interfaces list.\r\n */\r\nSWAC.Interfaces = function (keys, owner) {\r\n\r\n  //////////////\r\n  // PRIVATE  //\r\n  //////////////\r\n\r\n  var _cache = {},\r\n      _cachedEventPublisher = {},\r\n\r\n      _available = keys,\r\n\r\n      _owner = owner,\r\n\r\n      _requestedInterfacesList = [],\r\n\r\n      /**\r\n       * Returns a list of names for all Interfaces defined in component\r\n       *\r\n       * @method list\r\n       * @return {Array} Array of strings containing the interface names\r\n       */\r\n      _list = function () {\r\n        return _available;\r\n      },\r\n\r\n       /**\r\n       * Check if an interface exists for the current component.\r\n       *\r\n       * @method has\r\n       * @param {String} name name of the interface.\r\n       * @return {Boolean} true or false if the interface exists.\r\n       */\r\n      _has = function (name) {\r\n        return (SWAC._internal.Utils.indexOf(_available, name) >= 0);\r\n      },\r\n\r\n       /**\r\n       * Method for searching an interface inside _requestedInterfacesList array.\r\n       *\r\n       * @private\r\n       * @method _findInRequestedInterfacesList\r\n       * @param {String} interfaceName name of the interface.\r\n       * @return {Boolean} true or false if the interface is found.\r\n       */\r\n      _findInRequestedInterfacesList = function (interfaceName) {\r\n        var i;\r\n        for (i = 0; i < _requestedInterfacesList.length; i++) {\r\n          if (_requestedInterfacesList[i].name === interfaceName) {\r\n            return true;\r\n          }\r\n        }\r\n        return false;\r\n      },\r\n\r\n       /**\r\n       * Callback for beginRequestInterface.\r\n       *\r\n       * @private\r\n       * @method _beginRequestInterfaceCallback\r\n       * @param {String} name name of the interface.\r\n       * @param {String} response beginRequestInterface call response.\r\n       * @param {Boolean} reject if true the defer objects will be rejected, otherwise it will be fulfilled.\r\n       */\r\n      _beginRequestInterfaceCallback = function (name, response, reject) {\r\n        var i;\r\n\r\n        for (i = _requestedInterfacesList.length - 1; i >= 0; i--) {\r\n          if (_requestedInterfacesList[i].name === name) {\r\n            if (!reject) {\r\n              _requestedInterfacesList[i].defer.fulfill(response);\r\n            }\r\n            else {\r\n              _requestedInterfacesList[i].defer.reject(response);\r\n            }\r\n            _requestedInterfacesList.splice(i, 1);\r\n          }\r\n        }\r\n      },\r\n\r\n      /**\r\n      * Get the specified interface\r\n      *\r\n      * @method beginGet\r\n      * @param {String} name name of the required interface.\r\n      * @return {Object} an object defer.promise\r\n      */\r\n      _beginGet = function (name) {\r\n        var defer = new SWAC.Defer();\r\n\r\n\r\n        if (_cache[name]) {\r\n          defer.fulfill(_cache[name]);\r\n        }\r\n        else if (_has(name)) {\r\n          if (!_findInRequestedInterfacesList(name)) {\r\n            _owner._internal.beginRequestInterface(name).then(\r\n                function (value) {\r\n                  _beginRequestInterfaceCallback(name, value, false);\r\n                  SWAC.Communication._internal.call(_owner.name(), 'interfaceReady', [name]); // Send interfaceReady here after fulfulling the promise with the interface, otherwise there might be a timing issue where the component got activated before the interface user can actually register for any event!\r\n                },\r\n                function (reason) {\r\n                  _beginRequestInterfaceCallback(name, reason, true);\r\n                });\r\n          }\r\n          _requestedInterfacesList.push({ name: name, defer: defer });\r\n        }\r\n        else {\r\n          defer.reject(new SWAC.Reason(14001));\r\n        }\r\n\r\n        return defer.promise;\r\n      },\r\n\r\n       /**\r\n      * Create a message for calling a method from container to component\r\n      *\r\n      * @private\r\n      * @method _beginCall\r\n      * @param {string} method method to call\r\n      * @param {object} args method's argument\r\n      * @return {object} an object defer.promise.\r\n      */\r\n      _beginCall = function (method, args, inf) {\r\n        return SWAC.Communication._internal.beginCall(_owner.name(), SWAC.Config.TimeOuts.Proxy.Functions, 'call', [method, args, inf]);\r\n      },\r\n\r\n      /**\r\n      * Method that exposes interface's methods and events\r\n      *\r\n      * @protected\r\n      * @method exposeInterface\r\n      * @param {string} name name of the interface\r\n      * @param {object} api list of method exported by interface\r\n      * @param {object} events list of events exported by interface\r\n      */\r\n      _exposeInterface = function (name, api, events) {\r\n        var inf = {},\r\n            method,\r\n            args,\r\n            fn,\r\n            i = 0,\r\n            event,\r\n            evPub;\r\n\r\n        if (!_cache[name]) {\r\n          //// Methods\r\n          for (method in api) {\r\n            if (api.hasOwnProperty(method)) {\r\n              args = api[method].join(', ');\r\n              fn = 'return function (' + args + ') { var myargs = Array.prototype.slice.call(arguments, 0); var args = [\"' + method + '\", myargs, \"' + name + '\" ]; return fn.apply( ctx, args ); };';\r\n              /* jshint -W054 */\r\n              inf[method] = (new Function('ctx', 'fn', fn))(this, _beginCall);\r\n              /* jshint +W054 */\r\n            }\r\n          }\r\n\r\n          //// EVENTS\r\n          for (i = 0; i < events.length; i++) {\r\n            event = events[i];\r\n            evPub = new SWAC.Eventing.Publisher(event);\r\n            _cachedEventPublisher[name] = _cachedEventPublisher[name] || {};\r\n            _cachedEventPublisher[name][event] = evPub;\r\n            inf[event] = evPub.event;\r\n          }\r\n\r\n          _cache[name] = inf;\r\n\r\n        }\r\n      },\r\n\r\n       /**\r\n      * Method for firing event from the cached interface\r\n      *\r\n      * @protected\r\n      * @method fire\r\n      * @param {String} evtname name of the event.\r\n      * @param {Object} evtobject object of the event.\r\n      * @param {Object} inf interface.\r\n      */\r\n      _fireEvent = function (eventName, event, inf) {\r\n        if (_cachedEventPublisher[inf] && _cachedEventPublisher[inf][eventName]) {\r\n          _cachedEventPublisher[inf][eventName].notify(event);\r\n        }\r\n      };\r\n\r\n  //////////////\r\n  // PUBLIC   //\r\n  //////////////\r\n\r\n  this.list = _list;\r\n  this.beginGet = _beginGet;\r\n  this.has = _has;\r\n\r\n  this._internal = {\r\n    exposeInterface: _exposeInterface,\r\n    fire: _fireEvent\r\n  };\r\n};\r\n\r\n\r\n///////////////////////////////////////////\r\n// lib/container/services.js\r\n\r\n\r\n/**\r\n *  Services is the registry for all services exposing interfaces to be used by containers. (in-container)\r\n *\r\n * @class SWAC.Services\r\n * @constructor\r\n */\r\nSWAC.Services = (function () {\r\n\r\n  //////////////\r\n  // PRIVATE  //\r\n  //////////////\r\n\r\n  var _services = {},\r\n\t  _serviceOptions = {},\r\n    _serviceContainerInstance = {},\r\n\t  _handlers = [],\r\n\r\n\t  /**\r\n\t   * Fired whenever a component-specific service instance got created\r\n\t   *\r\n\t   * @event onServiceCreated\r\n\t   */\r\n\t  _onServiceCreated = new SWAC.Eventing.Publisher('onServiceCreated'),\r\n\r\n\t   /**\r\n\t   * Fired whenever a component-specific service instance got removed\r\n\t   *\r\n\t   * @event _onServiceRemoved\r\n\t   */\r\n\t  _onServiceRemoved = new SWAC.Eventing.Publisher('_onServiceRemoved'),\r\n\r\n\t  _cache = {}, // stores all component-bound services (those are the instances, singletons are used directly from the registry) -> _cache[componentname][service]\r\n\r\n\t  /**\r\n\t  * Return the array of services names available in container\r\n\t  *\r\n\t  * @method list\r\n\t  * @param {object} options filter object operating on service options\r\n\t  * @return {Object} List of services names provided by container.\r\n\t  */\r\n\t  _list = function (options) {\r\n\t\tvar propName = '',\r\n\t\t  parkFilter = [],\r\n\t\t  serviceName = '',\r\n\t\t  filterOK = true;\r\n\r\n\t\tfor (serviceName in _services) {\r\n\t\t  if (_services.hasOwnProperty(serviceName)) {\r\n\t\t\tif (typeof options === 'object') {\r\n\t\t\t  filterOK = true;\r\n\t\t\t  for (propName in options) {\r\n\t\t\t\tif (options.hasOwnProperty(propName)) {\r\n\t\t\t\t  if (typeof _serviceOptions[serviceName][propName] !== 'undefined') {\r\n\t\t\t\t\tfilterOK = filterOK && (_serviceOptions[serviceName][propName] === options[propName]);\r\n\t\t\t\t  }\r\n\t\t\t\t  else {\r\n\t\t\t\t\tfilterOK = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t  }\r\n\t\t\t\t}\r\n\t\t\t  }\r\n\t\t\t  if (filterOK) {\r\n\t\t\t\tparkFilter.push(serviceName);\r\n\t\t\t  }\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t  parkFilter.push(serviceName);\r\n\t\t\t}\r\n\t\t  }\r\n\t\t}\r\n\t\treturn parkFilter;\r\n\t  },\r\n\r\n\t  /**\r\n\t   * Return the options of requested service\r\n\t   *\r\n\t   * @method getInfo\r\n\t   * @param {String} serviceName Name of the service\r\n\t   * @return {Object} Options object.\r\n\t  */\r\n\t\t_getInfo = function (serviceName) {\r\n\t\t  return _serviceOptions.hasOwnProperty(serviceName) ? _serviceOptions[serviceName] : {};\r\n\t\t},\r\n      /**\r\n\t   * Return the container instance of requested service\r\n\t   *\r\n\t   * @method getLocal\r\n\t   * @param {String} name Name of the service\r\n\t   * @return {Object} Instance instance of the service.\r\n\t  */\r\n    _getLocal = function (name) {\r\n      return _serviceContainerInstance.hasOwnProperty(name) ? _serviceContainerInstance[name] : null;\r\n    },\r\n\r\n\t   /**\r\n\t   * Registers a service to be available for a SWAC component\r\n\t   *\r\n\t   * @method register\r\n\t   * @param {String} name Name of the service to register\r\n\t   * @param {Object} service service\r\n\t   * @param {Object} options service options\r\n\t   * @param {Object} local container service    \r\n\t   * @return {function} Returns true if service is not yet registered, false otherwise.\r\n\t   */\r\n\t  _register = function (name, service, options, local) { \r\n\t\tvar optionsProp = '', ServiceConstructor = null;\r\n\r\n\t\tif (!name || !name.match('^[a-zA-Z0-9_.]*$')) {\r\n\t\t  return false;\r\n\t\t}\r\n\t\tif (_services[name]) {\r\n\t\t  return false;\r\n\t\t}\r\n\t\t_services[name] = service;\r\n\t\t_serviceOptions[name] = {};\r\n\t\tif (options && (typeof options === 'object')) {\r\n\t\t  for (optionsProp in options) {\r\n\t\t\t  if (options.hasOwnProperty(optionsProp)) {\r\n\t\t\t    _serviceOptions[name][optionsProp] = options[optionsProp];\r\n\t\t\t  }\r\n\t\t  }\r\n\t\t}\r\n\t\t_serviceOptions[name]['singleton'] = !(service instanceof Function); //predefined info\r\n\t\tif (typeof _serviceOptions[name]['delegable'] !== 'boolean') {\r\n\t\t  _serviceOptions[name]['delegable'] = true;\r\n\t\t}\r\n\t\tif (local) {\r\n\t\t  if (local instanceof Function) {\r\n\t\t    ServiceConstructor = local;\r\n\t\t    _serviceContainerInstance[name] = new ServiceConstructor();\r\n\t\t  }\r\n\t\t  else {\r\n\t\t    _serviceContainerInstance[name] = local;\r\n\t\t  }\r\n\t\t}\r\n\r\n\r\n\t\treturn true;\r\n\t  },\r\n\r\n\r\n\r\n\t   /**\r\n\t   * Event handler\r\n\t   *\r\n\t   * @private\r\n\t   * @method _handler\r\n\t   * @param {String} componentName Name of the component\r\n\t   * @param {String} eventName Name of the event\r\n\t   * @param {String} service Name of the service\r\n\t   * @return {function} Returns a function that fires the event\r\n\t   */\r\n\t  _handler = function (componentName, eventName, service) {\r\n\t\treturn function (event) {\r\n\t\t  SWAC.Communication._internal.fire(componentName, eventName, event, service);\r\n\t\t};\r\n\t  },\r\n\r\n\t  /**\r\n\t   * Request of the component service\r\n\t   *\r\n\t   * @protected\r\n\t   * @method beginRequestService\r\n\t   * @param {String} name service name\r\n\t   * @param {String} component component name\r\n\t   * @return {Object} an object containing the name of the service, its methods and events\r\n\t   */\r\n\t  _beginRequestService = function (name, component) {\r\n\t\tvar interfaces = SWAC._internal.Utils.getOwnPropertyNames(_services),\r\n\t\t\texpose,\r\n\t\t\tisSingleton,\r\n\t\t\trealCmpName = component,\r\n\t\t\tanswerDefer = new SWAC.Defer(),\r\n\t\t\tproceedDefer = new SWAC.Defer(),\r\n\t\t\tproceedPromise,\r\n\t\t\tfullName = SWAC._internal.Utils.getFullName(),\r\n\t\t\tprealCmpName = component;\r\n\r\n\t\tif (SWAC._internal.Utils.isArray(realCmpName)) {\r\n\t\t\trealCmpName = JSON.stringify(realCmpName);\r\n\t\t}\r\n\r\n\r\n\t\tproceedPromise = proceedDefer.promise.then(function (servObj) {\r\n\t\t\tvar api = {},\r\n\t\t\t\tevents = [],\r\n\t\t\t\tproperty,\r\n\t\t\t\tserviceDest = SWAC._internal.Utils.getFullName() || ['<root>'],\r\n\t\t\t\tpark;\r\n\r\n\t\t  if (typeof servObj === 'object' && typeof servObj.name === 'string') {\r\n\t\t\treturn servObj;\r\n\t\t  }\r\n\r\n\t\t  for (property in servObj) {\r\n\t\t\tif (servObj.hasOwnProperty(property)) {\r\n\t\t\t  // Parse available Methods\r\n\t\t\t  if (typeof servObj[property] === 'function') {\r\n\t\t\t      api[property] = SWAC._internal.Utils.estractParameters(servObj[property]);\r\n\t\t\t  }\r\n\t\t\t\t// Parse available Events\r\n\t\t\t  else if ((typeof servObj[property] === 'object') &&\r\n\t\t\t\t\t\t(servObj[property].subscribe) &&\r\n\t\t\t\t\t\t(servObj[property].subscribe.length === 1)) {\r\n\t\t\t\t// Subscribe to event and let handler call aproporate call towards container.\r\n\t\t\t\tpark = _handler(realCmpName, property, name);\r\n\t\t\t\tservObj[property].subscribe(park);\r\n\t\t\t\t_handlers.push({ component: realCmpName, property: property, handler: park, event: servObj[property] });\r\n\t\t\t\tevents.push(property);\r\n\t\t\t  }\r\n\t\t\t}\r\n\t\t  }\r\n\t\t  return { name: name, api: api, events: events, provider: serviceDest };\r\n\t\t}, function (reason) { throw reason; });\r\n\r\n\r\n\t\tif (SWAC._internal.Utils.indexOf(interfaces, name) >= 0) {\r\n\t\t  expose = _services[name]; // Constructor of a service gets passed in name of the originating component\r\n\t\t  isSingleton = !(expose instanceof Function);\r\n\t\t  if (!isSingleton) {\r\n\t\t\t_cache[realCmpName] = (_cache[realCmpName] || {});\r\n\t\t\tif (_cache[realCmpName][name]) {\r\n\t\t\t  expose = _cache[realCmpName][name];\r\n\t\t\t} else {\r\n\t\t\t  expose = new _services[name](realCmpName);\r\n\t\t\t  _cache[realCmpName][name] = expose;\r\n\t\t\t  if (fullName === null ||\r\n\t\t\t\t\t(fullName.length + 1 === prealCmpName.length)) {\r\n\r\n\t\t\t\tif (fullName === null) {\r\n\t\t\t\t  fullName = ['<root>'];\r\n\t\t\t\t}\r\n\t\t\t\tprealCmpName = prealCmpName.toString().substring(fullName.toString().length + 1, prealCmpName.toString().length);\r\n\t\t\t\t_onServiceCreated.notify({ component: prealCmpName, service: name, instance: expose });\r\n\t\t\t  }\r\n\t\t\t  else {\r\n\t\t\t\tprealCmpName = JSON.stringify(prealCmpName);\r\n\t\t\t\t_onServiceCreated.notify({ component: prealCmpName, service: name, instance: expose, delegated: true });\r\n\t\t\t  }\r\n\t\t\t}\r\n\t\t  }\r\n\r\n\t\t  proceedPromise.then(function (serviceInf) {\r\n\t\t\tanswerDefer.fulfill(serviceInf);\r\n\t\t  }, function (reason) {\r\n\t\t\tanswerDefer.reject(reason);\r\n\t\t  });\r\n\t\t  proceedDefer.fulfill(expose);\r\n\t\t}\r\n\t\telse if (typeof SWAC.Hub.instance === 'object') {\r\n\t\t  SWAC.Hub.instance.services._internal.beginGetInternal(name, component).then(\r\n\t\t\tfunction (value) {\r\n\t\t\t  proceedDefer.fulfill(value);\r\n\t\t\t  proceedPromise.then(function (serviceInf) {\r\n\t\t\t\tanswerDefer.fulfill(serviceInf);\r\n\t\t\t  }, function (reason) {\r\n\t\t\t\tanswerDefer.reject(reason);\r\n\t\t\t  });\r\n\t\t\t},\r\n\t\t\tfunction (reason) {\r\n\t\t\t  answerDefer.reject(reason);\r\n\t\t\t}\r\n\t\t  );\r\n\t\t}\r\n\t\telse {\r\n\t\t  answerDefer.reject(new SWAC.Reason(12001));\r\n\t\t}\r\n\t\treturn answerDefer.promise;\r\n\t  },\r\n\r\n\t   /**\r\n\t   * Remove all component-bound service instances.\r\n\t   *\r\n\t   * @protected\r\n\t   * @method removeServices\r\n\t   * @param {String} componentName component name\r\n\t   */\r\n\t  _removeServices = function (componentName) {\r\n\t\t  var cachedCmpService = Object.getOwnPropertyNames(_cache),\r\n\t\t\t  cmpList = [componentName],\r\n\t\t\t  i = 0,\r\n\t\t\t  relCmpName = JSON.parse(componentName),\r\n\t\t\t  otherCmp = [],\r\n\t\t\t  isNephew = true,\r\n\t\t\t  j = 0,\r\n\t\t\t  cs = null,\r\n\t\t\t  serviceinstances,\r\n\t\t\t  component,\r\n\t\t\t  prealCmpName,\r\n\t\t\t  fullName = SWAC._internal.Utils.getFullName();\r\n\r\n\t\tfor (i = 0; i < cachedCmpService.length; i++) {\r\n\t\t  if (cachedCmpService[i].length > componentName.length) { //it can be a nephew\r\n\t\t\totherCmp = JSON.parse(cachedCmpService[i]);\r\n\t\t\tif (otherCmp.length > relCmpName.length) { //yes, maybe\r\n\t\t\t  isNephew = true;\r\n\t\t\t  for (j = 0; j < relCmpName.length && isNephew; j++) {\r\n\t\t\t\tif (relCmpName[j] !== otherCmp[j]) {\r\n\t\t\t\t  isNephew = false;\r\n\t\t\t\t}\r\n\t\t\t  }\r\n\t\t\t  if (isNephew) {\r\n\t\t\t\tcmpList.push(cachedCmpService[i]);\r\n\t\t\t  }\r\n\t\t\t}\r\n\t\t  }\r\n\t\t}\r\n\t\tfor (j = 0; j < cmpList.length; j++) {\r\n\t\t  component = cmpList[j];\r\n\t\t  cs = _cache[component];\r\n\t\t  // remove handlers\r\n\t\t  for (i = _handlers.length - 1; i >= 0; i--) {\r\n\t\t\tif (_handlers[i].component === component) {\r\n\t\t\t  if (_handlers[i].event.unsubscribe) {\r\n\t\t\t\t_handlers[i].event.unsubscribe(_handlers[i].handler);\r\n\t\t\t  }\r\n\t\t\t  _handlers.splice(i, 1);\r\n\t\t\t}\r\n\t\t  }\r\n\t\t  if (cs) {\r\n\t\t\tserviceinstances = SWAC._internal.Utils.getOwnPropertyNames(cs);\r\n\t\t\tprealCmpName = JSON.parse(component);\r\n\t\t\tfor (i = 0; i < serviceinstances.length; i++) {\r\n\t\t\t  if (fullName === null ||\r\n\t\t\t\t\t(fullName.length + 1 === prealCmpName.length)) {\r\n\r\n\t\t\t\tif (fullName === null) {\r\n\t\t\t\t  fullName = ['<root>'];\r\n\t\t\t\t}\r\n\t\t\t\tprealCmpName = prealCmpName.toString().substring(fullName.toString().length + 1, prealCmpName.toString().length);\r\n\t\t\t\t_onServiceRemoved.notify({ component: prealCmpName, service: serviceinstances[i]});\r\n\r\n\t\t\t  }\r\n\t\t\t  else {\r\n\t\t\t\tprealCmpName = JSON.stringify(prealCmpName);\r\n\t\t\t\t_onServiceRemoved.notify({ component: prealCmpName, service: serviceinstances[i], delegated: true });\r\n\t\t\t  }\r\n\t\t\t  delete _cache[component][serviceinstances[i]];\r\n\t\t\t}\r\n\t\t  }\r\n\t\t}\r\n\t  },\r\n\r\n\t  /**\r\n\t  * Method for calling a method using a service\r\n\t  *\r\n\t  * @protected\r\n\t  * @method callMethod\r\n\t  * @param {String} componentFull component full name\r\n\t  * @param {object} service name of the service\r\n\t  * @param {string} method method to call\r\n\t  * @param {object} args method's argument\r\n\t  * @return {object} value returned by service's method\r\n\t  */\r\n\t  _callMethod = function (componentFull, service, method, args) {\r\n\t\t  var svc = null,\r\n\t\t\t  res = null,\r\n\t\t\t  component = componentFull;\r\n\r\n\t\tif (SWAC._internal.Utils.isArray(component)) {\r\n\t\t  component = JSON.stringify(componentFull);\r\n\t\t}\r\n\r\n\t\tif (_cache[component] && _cache[component][service]) {\r\n\t\t  svc = _cache[component][service];\r\n\t\t  res = svc[method].apply(service, args);\r\n\r\n\t\t} else if (_services[service]) {\r\n\t\t  svc = _services[service];\r\n\t\t  res = svc[method].apply(service, args);\r\n\t\t}\r\n\t\treturn res;\r\n\t  };\r\n\r\n  //////////////\r\n  // PUBLIC   //\r\n  //////////////\r\n\r\n  return {\r\n\r\n\t// API\r\n\tlist: _list,\r\n\tregister: _register,\r\n\tgetInfo: _getInfo,\r\n\tgetLocal: _getLocal,\r\n\tonServiceCreated: _onServiceCreated.event,\r\n\tonServiceRemoved: _onServiceRemoved.event,\r\n\r\n\t// INTERNAL, DO NOT USE\r\n\t_internal: {\r\n\t  beginRequestService: _beginRequestService,\r\n\t  removeServices: _removeServices,\r\n\t  callMethod: _callMethod\r\n\t}\r\n  };\r\n\r\n}());\r\n\r\n    return SWAC;\r\n  };\r\n\r\n  try {\r\n    if ((typeof module !== 'undefined') && (typeof module.exports !== 'undefined')) {\r\n      var SWACConstructor = require('@swac/base');\r\n      if (typeof SWACConstructor.prototype.Container !== 'object') {\r\n        swacContainerModule(SWACConstructor.prototype);\r\n      }\r\n      module.exports = SWACConstructor;\r\n      module.exports['default'] = module.exports;\r\n    }\r\n    else if ((typeof SystemJS !== 'undefined') && SystemJS.map.hasOwnProperty('@swac/base')) {\r\n      define('@swac/container', ['@swac/base'], function (base) {\r\n        if (typeof base.prototype.Container !== 'object') {\r\n          swacContainerModule(base.prototype);\r\n        }\r\n        return base;\r\n      });\r\n    }\r\n    else if ((typeof define === 'function') && (typeof define.amd !== 'undefined') &&\r\n            (typeof requirejs !== 'undefined') && (typeof requirejs.s.contexts._.config.paths['@swac/base'] !== 'undefined')) {\r\n      define('@swac/container', ['@swac/base'], function (base) {\r\n        if (typeof base.prototype.Container !== 'object') {\r\n          swacContainerModule(base.prototype);\r\n        }\r\n        return base;\r\n      });\r\n    }\r\n    else {\r\n      throw new Error('SWAC on window');\r\n    }\r\n  }\r\n  catch (e) {\r\n    if (typeof window.SWAC.constructor.prototype.Container !== 'object') {\r\n      swacContainerModule(window.SWAC.constructor.prototype);\r\n    }\r\n  }\r\n\r\n})();"]}